---
title: MYSQL安装
date: 2022-04-08 11:53:11
permalink: /pages/5be280/
categories:
  - 运维
  - mysql
tags:
  - 
---
# MYSQL 安装 #

## 1、使用YUM/APT进行安装 ##

安装前，请查看您的操作系统版本和内核版本

```bash
root@DESKTOP-KK8078I:/tmp# uname -a
Linux DESKTOP-KK8078I 4.19.104-microsoft-standard #1 SMP Wed Feb 19 06:37:35 UTC 2020 x86_64 x86_64 x86_64 GNU/Linux
```

![1](https://lgx_248920070.gitee.io/lgxblog/img/1.png)

选择相应的分发版进行安装，注意mysql版本

### 1.1 添加YUM/APT仓库文件 ###

[https://dev.mysql.com/downloads/](https://dev.mysql.com/downloads/ "https://dev.mysql.com/downloads/")

这里以 **CENTOS 8 **为例子进行测试，系统具体版本请参照上文图片进行。

![](https://lgx_248920070.gitee.io/lgxblog/img/2.png)

![](https://lgx_248920070.gitee.io/lgxblog/img/3.png)

![](https://lgx_248920070.gitee.io/lgxblog/img/4.png)

使用wget进行下载

```bash
root@DESKTOP-KK8078I:~# wget https://dev.mysql.com/get/mysql80-community-release-el7-3.noarch.rpm
--2020-07-17 14:03:12--  https://dev.mysql.com/get/mysql80-community-release-el7-3.noarch.rpm
Resolving dev.mysql.com (dev.mysql.com)... 137.254.60.11
Connecting to dev.mysql.com (dev.mysql.com)|137.254.60.11|:443... connected.
HTTP request sent, awaiting response... 302 Found
Location: https://repo.mysql.com//mysql80-community-release-el7-3.noarch.rpm [following]
--2020-07-17 14:03:13--  https://repo.mysql.com//mysql80-community-release-el7-3.noarch.rpm
Resolving repo.mysql.com (repo.mysql.com)... 23.40.193.17
Connecting to repo.mysql.com (repo.mysql.com)|23.40.193.17|:443... connected.
HTTP request sent, awaiting response... 200 OK
Length: 26024 (25K) [application/x-redhat-package-manager]
Saving to: ‘mysql80-community-release-el7-3.noarch.rpm’

mysql80-community-release-el7-3.noarch.rpm     100%[==================================================================================================>]  25.41K  89.1KB/s    in 0.3s    

2020-07-17 14:03:15 (89.1 KB/s) - ‘mysql80-community-release-el7-3.noarch.rpm’ saved [26024/26024]

```

### 1.2 YUM安装MYSQL ###

根据上面的选择对应的分发版版本进行安装

1.2.1 查看安装仓库文件是否成功

```bash
[root@localhost tmp]# sudo yum repolist enabled | grep 'mysql.*-community.*'
mysql-connectors-community MySQL Connectors Community
mysql-tools-community      MySQL Tools Community
mysql80-community          MySQL 8.0 Community Server
```

1.2.2 查看系统自带mysql/mariadb

```bash
[root@localhost tmp]# rpm -qa | grep -i maria
[root@localhost tmp]# rpm -qa | grep -i mysql
mysql80-community-release-el8-1.noarch
```

1.2.3 卸载可能冲突的软件包

```bash
[root@localhost tmp]# sudo yum -y remove mysql*
[root@localhost tmp]# sudo yum -y remove maria*
```

1.2.4 安装mysql-server

```bash
[root@localhost tmp]# sudo yum -y install mysql-server
Last metadata expiration check: 0:07:54 ago on Fri 17 Jul 2020 11:52:25 PM CST.
Dependencies resolved.
===========================================================================================================================================================================================
 Package                                            Architecture                   Version                                                         Repository                         Size
===========================================================================================================================================================================================
Installing:
 mysql-server                                       x86_64                         8.0.17-3.module_el8.0.0+181+899d6349                            AppStream                          22 M
Installing dependencies:
 mariadb-connector-c-config                         noarch                         3.0.7-1.el8                                                     AppStream                          13 k
 mecab                                              x86_64                         0.996-1.module_el8.0.0+41+ca30bab6.9                            AppStream                         397 k
 mysql                                              x86_64                         8.0.17-3.module_el8.0.0+181+899d6349                            AppStream                          11 M
 mysql-common                                       x86_64                         8.0.17-3.module_el8.0.0+181+899d6349                            AppStream                         143 k
 mysql-errmsg                                       x86_64                         8.0.17-3.module_el8.0.0+181+899d6349                            AppStream                         557 k
 protobuf-lite                                      x86_64                         3.5.0-7.el8                                                     AppStream                         150 k
Enabling module streams:
 mysql                                                                             8.0                                                                                                    

Transaction Summary
===========================================================================================================================================================================================
Install  7 Packages

Total download size: 33 M
Installed size: 216 M

```bash
1.2.5 启动数据库
```

[root@localhost tmp]# sudo systemctl start mysqld
[root@localhost tmp]# sudo systemctl status mysqld
● mysqld.service - MySQL 8.0 database server
   Loaded: loaded (/usr/lib/systemd/system/mysqld.service; disabled; vendor preset: disabled)
   Active: active (running) since Sat 2020-07-18 00:04:06 CST; 5s ago
  Process: 32449 ExecStartPost=/usr/libexec/mysql-check-upgrade (code=exited, status=0/SUCCESS)
  Process: 32323 ExecStartPre=/usr/libexec/mysql-prepare-db-dir mysqld.service (code=exited, status=0/SUCCESS)
  Process: 32298 ExecStartPre=/usr/libexec/mysql-check-socket (code=exited, status=0/SUCCESS)
 Main PID: 32407 (mysqld)
   Status: "Server is operational"
    Tasks: 39 (limit: 10272)
   Memory: 495.8M
   CGroup: /system.slice/mysqld.service
           └─32407 /usr/libexec/mysqld --basedir=/usr

Jul 18 00:04:02 localhost.localdomain systemd[1]: Starting MySQL 8.0 database server...
Jul 18 00:04:02 localhost.localdomain mysql-prepare-db-dir[32323]: Initializing MySQL database
Jul 18 00:04:06 localhost.localdomain systemd[1]: Started MySQL 8.0 database server.

```
### 1.3 APT安装MYSQL ###

1.3.1 下载并安装deb安装包

```bash
root@DESKTOP-KK8078I:~# wget https://dev.mysql.com/get/mysql-apt-config_0.8.15-1_all.deb
--2020-07-17 14:06:37--  https://dev.mysql.com/get/mysql-apt-config_0.8.15-1_all.deb
Resolving dev.mysql.com (dev.mysql.com)... 137.254.60.11
Connecting to dev.mysql.com (dev.mysql.com)|137.254.60.11|:443... connected.
HTTP request sent, awaiting response... 302 Found
Location: https://repo.mysql.com//mysql-apt-config_0.8.15-1_all.deb [following]
--2020-07-17 14:06:38--  https://repo.mysql.com//mysql-apt-config_0.8.15-1_all.deb
Resolving repo.mysql.com (repo.mysql.com)... 23.40.193.17
Connecting to repo.mysql.com (repo.mysql.com)|23.40.193.17|:443... connected.
HTTP request sent, awaiting response... 200 OK
Length: 35532 (35K) [application/x-debian-package]
Saving to: ‘mysql-apt-config_0.8.15-1_all.deb’

mysql-apt-config_0.8.15-1_all.deb              100%[==================================================================================================>]  34.70K  --.-KB/s    in 0.08s   

2020-07-17 14:06:39 (408 KB/s) - ‘mysql-apt-config_0.8.15-1_all.deb’ saved [35532/35532]
```

选择MySQL-8.0 点击OK继续安装

![](https://lgx_248920070.gitee.io/lgxblog/img/5.png)

```bash
root@DESKTOP-KK8078I:/tmp# sudo apt-get install ./mysql-apt-config_0.8.15-1_all.deb 
Reading package lists... Done
Building dependency tree       
Reading state information... Done
Note, selecting 'mysql-apt-config' instead of './mysql-apt-config_0.8.15-1_all.deb'
The following NEW packages will be installed:
  mysql-apt-config
0 upgraded, 1 newly installed, 0 to remove and 69 not upgraded.
Need to get 0 B/35.5 kB of archives.
After this operation, 35.8 kB of additional disk space will be used.
Get:1 /tmp/mysql-apt-config_0.8.15-1_all.deb mysql-apt-config all 0.8.15-1 [35.5 kB]
Preconfiguring packages ...
Selecting previously unselected package mysql-apt-config.
(Reading database ... 64037 files and directories currently installed.)
Preparing to unpack .../mysql-apt-config_0.8.15-1_all.deb ...
Unpacking mysql-apt-config (0.8.15-1) ...
Setting up mysql-apt-config (0.8.15-1) ...
Warning: apt-key should not be used in scripts (called from postinst maintainerscript of the package mysql-apt-config)
OK
```

1.3.2 安装mysql

```bash
root@DESKTOP-KK8078I:~# sudo apt-get -y install mysql-server
Reading package lists... Done
Building dependency tree       
Reading state information... Done
The following additional packages will be installed:
  libcgi-fast-perl libcgi-pm-perl libencode-locale-perl libevent-core-2.1-7 libfcgi-perl libhtml-parser-perl libhtml-tagset-perl libhtml-template-perl libhttp-date-perl
  libhttp-message-perl libio-html-perl liblwp-mediatypes-perl libmecab2 libtimedate-perl liburi-perl mecab-ipadic mecab-ipadic-utf8 mecab-utils mysql-client-8.0 mysql-client-core-8.0
  mysql-common mysql-server-8.0 mysql-server-core-8.0
Suggested packages:
  libdata-dump-perl libipc-sharedcache-perl libwww-perl mailx tinyca
The following NEW packages will be installed:
  libcgi-fast-perl libcgi-pm-perl libencode-locale-perl libevent-core-2.1-7 libfcgi-perl libhtml-parser-perl libhtml-tagset-perl libhtml-template-perl libhttp-date-perl
  libhttp-message-perl libio-html-perl liblwp-mediatypes-perl libmecab2 libtimedate-perl liburi-perl mecab-ipadic mecab-ipadic-utf8 mecab-utils mysql-client-8.0 mysql-client-core-8.0
  mysql-common mysql-server mysql-server-8.0 mysql-server-core-8.0
0 upgraded, 24 newly installed, 0 to remove and 69 not upgraded.
Need to get 0 B/30.3 MB of archives.
After this operation, 246 MB of additional disk space will be used.
Preconfiguring packages ...

```

## 2、使用二进制进行安装 ##

YUM/APT进行安装可能会出现与其他已安装软件冲突的情况，并且会要求安装其他一些依赖项，这个时候我们可以选择通过官方给出的二进制文件进行安装
这里我们以 社区版 （MySQL Community Server）**mysql-5.7.22-linux-glibc2.12-x86_64**进行示例安装
其他版本可以去官方网站下载[https://dev.mysql.com/downloads/mysql/](https://dev.mysql.com/downloads/mysql/)

### 2.1 基于YUM的系统 二进制安装MYSQL ###

2.1.1 安装libaio依赖库

```bash
root@DESKTOP-KK8078I:/tmp# sudo yum -y install libaio1
```

以下步骤接

> 2.2.2 从mysql官方网站下载mysql二进制文件

### 2.2 基于APT的系统 二进制安装MYSQL ###

2.2.1 安装libaio依赖库

```bash
root@Ubuntu20:/tmp# sudo apt-get install libaio1
```

2.2.2 从mysql官方网站下载mysql二进制文件
[https://dev.mysql.com/downloads/mysql/](https://dev.mysql.com/downloads/mysql/)

2.2.3 添加mysql用户和组

```bash
root@DESKTOP-KK8078I:/tmp/mysql-5.7.22# sudo groupadd mysql
root@DESKTOP-KK8078I:/tmp/mysql-5.7.22# sudo useradd -r -g mysql -s /bin/false mysql
```

2.2.4 解压tar压缩包
这里我们选择将二进制文件放在 `/tmp/`文件夹，采用`-C`命令解压到其他文件夹，默认安装目录建议安装在 `/opt/`下，`/opt/`下，是一些大型软件的安装目录，或者是一些服务程序的安装目录。

```bash
root@DESKTOP-KK8078I:/tmp# tar zxvf mysql-5.7.22-linux-glibc2.12-x86_64.tar.gz -C /opt/
mysql-5.7.22-linux-glibc2.12-x86_64/bin/myisam_ftdump
mysql-5.7.22-linux-glibc2.12-x86_64/bin/myisamchk
mysql-5.7.22-linux-glibc2.12-x86_64/bin/myisamlog
mysql-5.7.22-linux-glibc2.12-x86_64/bin/myisampack
mysql-5.7.22-linux-glibc2.12-x86_64/bin/mysql
mysql-5.7.22-linux-glibc2.12-x86_64/bin/mysql_client_test_embedded
mysql-5.7.22-linux-glibc2.12-x86_64/bin/mysql_config_editor
root@DESKTOP-KK8078I:/tmp# cd /opt/mysql-5.7.22-linux-glibc2.12-x86_64/
root@DESKTOP-KK8078I:/opt/mysql-5.7.22-linux-glibc2.12-x86_64# ls
COPYING  README  bin  docs  include  lib  man  share  support-files
```

2.2.5 制作符号链接
如果要进行版本更新的话，只需要更改符号链接就好

```bash
root@DESKTOP-KK8078I:/usr/local# sudo ln -s /opt/mysql-5.7.22-linux-glibc2.12-x86_64/ mysql
```

2.2.6 创建必要目录，并更改所有权为mysql

```bash
root@DESKTOP-KK8078I:/usr/local# cd mysql
root@DESKTOP-KK8078I:/usr/local/mysql# sudo mkdir mysql-files
root@DESKTOP-KK8078I:/usr/local/mysql# sudo chmod 750 mysql-files/
root@DESKTOP-KK8078I:/usr/local/mysql# sudo chown -R mysql .
root@DESKTOP-KK8078I:/usr/local/mysql# sudo chgrp -R mysql .
```

2.2.7 初始化mysql，并生成临时密码

```bash
root@DESKTOP-KK8078I:/usr/local/mysql# pwd
/usr/local/mysql
root@DESKTOP-KK8078I:/usr/local/mysql# bin/mysqld --initialize --user=appuser
2020-07-15T02:07:50.569193Z 0 [Warning] TIMESTAMP with implicit DEFAULT value is deprecated. Please use --explicit_defaults_for_timestamp server option (see documentation for more details).
2020-07-15T02:07:50.804494Z 0 [Warning] InnoDB: New log files created, LSN=45790
2020-07-15T02:07:50.866887Z 0 [Warning] InnoDB: Creating foreign key constraint system tables.
2020-07-15T02:07:50.891659Z 0 [Warning] No existing UUID has been found, so we assume that this is the first time that this server has been started. Generating a new UUID: fc73ed03-c63f-11ea-98ac-00155dc12faa.
2020-07-15T02:07:50.895757Z 0 [Warning] Gtid table is not ready to be used. Table 'mysql.gtid_executed' cannot be opened.
2020-07-15T02:07:50.899030Z 1 [Note] A temporary password is generated for root@localhost: esJzgRa7r>zL
```

mysql会生成临时密码，最好记下此密码

2.2.8 更改二进制文件所有权为root，数据文件改为mysql

```bash
root@DESKTOP-KK8078I:/usr/local/mysql# sudo chown -R root .
root@DESKTOP-KK8078I:/usr/local/mysql# sudo chown -R mysql data/ mysql-files/
```

2.2.9 复制启动脚本到init.d中

```bash
root@DESKTOP-KK8078I:/usr/local/mysql# sudo cp support-files/mysql.server /etc/init.d/mysql
```

2.2.10 将目录导入到环境变量

>**$PATH**：决定了shell将到哪些目录中寻找命令或程序，PATH的值是一系列目录，当您运行一个程序时，Linux在这些目录下进行搜寻编译链接。

修改$PATH的方法有很多，比如：

```bash
root@DESKTOP-KK8078I:/usr/local/mysql# export PATH=$PATH:/usr/local/mysql/bin
root@DESKTOP-KK8078I:/usr/local/mysql# echo $PATH
/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/games:/usr/local/games:/snap/bin:/usr/local/mysql/bin
```

但是这种方式修改的环境变量，在终端关闭后就会失效，所以不推荐此方式进行修改。

第二种：编辑`/etc/profile`文件，进行修改环境变量

```bash
root@DESKTOP-KK8078I:/usr/local/mysql/bin# vim /etc/profile
```

添加以下内容,并更新文件

```bash
MYSQL_HOME=/usr/local/mysql
PATH=$PATH:$MYSQL_HOME/bin
export PATH MYSQL_HOME
root@DESKTOP-KK8078I:/usr/local/mysql/bin# source /etc/profile
```

就算是更新完成了

## 3、systemd集成mysql ##

>**Systemd**是一个系统管理守护进程、工具和库的集合，用于取代System V初始进程。Systemd的功能是用于集中管理和配置类UNIX系统。
>**Systemctl**是一个systemd工具，主要负责控制systemd系统和服务管理器。

如果使用YUM/APT安装mysql的话，会自动生成systemd目录，而二进制文件安装的话，系统中并没有集成，建议手动添加systemd选项。

3.1 新建文件夹，并编辑文档

```bash
root@DESKTOP-KK8078I:/usr/local/mysql/bin# sudo mkdir -pv /etc/systemd/system/mysqld.service.d
mkdir: created directory '/etc/systemd/system/mysqld.service.d'
root@DESKTOP-KK8078I:/usr/local/mysql/bin# sudo vim /etc/systemd/system/mysqld.service.d/override.conf
```

3.2 添加以下内容

```mysql
[Service]
LimitNOFILE=max_open_files
Nice=nice_level
LimitCore=core_file_limit
Environment="LD_PRELOAD=/path/to/malloc/library"
Environment="TZ=time_zone_setting"
```

3.3 重新加载systemd配置，并启动mysql


```bash
root@DESKTOP-KK8078I:/usr/local/mysql/bin# systemctl daemon-reload
root@DESKTOP-KK8078I:/usr/local/mysql/bin# systemctl start mysql
root@DESKTOP-KK8078I:/usr/local/mysql/bin# systemctl status mysql
● mysql.service - LSB: start and stop MySQL
     Loaded: loaded (/etc/init.d/mysql; generated)
     Active: active (running) since Wed 2020-07-15 10:26:16 CST; 4h 20min ago
       Docs: man:systemd-sysv-generator(8)
      Tasks: 28 (limit: 7493)
     Memory: 183.4M
     CGroup: /system.slice/mysql.service
             ├─13626 /bin/sh /usr/local/mysql/bin/mysqld_safe --datadir=/usr/local/mysql/data --pid-file=/usr/local/mysql/data/DESKTOP-KK8078I.pid
             └─13710 /usr/local/mysql/bin/mysqld --basedir=/usr/local/mysql --datadir=/usr/local/mysql/data --plugin-dir=/usr/local/mysql/lib/plugin --user=mysql --log-error=DESKTOP-KK80>

```

## 4、MYSQL 启动，关闭，重启等操作 ##

如果您进行上一步的话，那就可以通过 `systemctl` 进行管理mysql服务的启动，关闭，重启等操作。

### 4.1 基于YUM的系统 ###

```bash
# 启动mysql
root@DESKTOP-KK8078I:/usr/local/mysql/bin# systemctl start mysqld
# 停止mysql
root@DESKTOP-KK8078I:/usr/local/mysql/bin# systemctl stop mysqld
# 重启mysql
root@DESKTOP-KK8078I:/usr/local/mysql/bin# systemctl restart mysqld
# 开机启动mysql
root@DESKTOP-KK8078I:/usr/local/mysql/bin# systemctl enable mysqld
# 关闭开机启动
root@DESKTOP-KK8078I:/usr/local/mysql/bin# systemctl disable mysqld
```

### 4.2 基于APT的系统 ###

```bash
# 启动mysql
root@DESKTOP-KK8078I:/usr/local/mysql/bin# systemctl start mysql
# 停止mysql
root@DESKTOP-KK8078I:/usr/local/mysql/bin# systemctl stop mysql
# 重启mysql
root@DESKTOP-KK8078I:/usr/local/mysql/bin# systemctl restart mysql
# 开机启动mysql
root@DESKTOP-KK8078I:/usr/local/mysql/bin# systemctl enable mysql
# 关闭开机启动
root@DESKTOP-KK8078I:/usr/local/mysql/bin# systemctl disable mysql
```

查看mysql服务是否已经开机启动

```bash
root@DESKTOP-KK8078I:~# systemctl is-enabled mysql
mysql.service is not a native service, redirecting to systemd-sysv-install.
Executing: /lib/systemd/systemd-sysv-install is-enabled mysql
enabled
```

修改root密码

```bash
mysql> alter user root@localhost identified by '123456';
Query OK, 0 rows affected (0.01 sec)
```