---
title: 局域网技术
date: 2023-05-15 16:01:38
permalink: /pages/d9e27a/
categories:
  - 专题
  - 软考中级
tags:
  - 
---
# 局域网技术

## 7. 局域网技术

### 7.1. 局域网概念

局域网( LAN ) 是指**有限区域**内（ 例如办公室或楼层） 的**多台计算机**通过**传输介质互联**， 所组成的封闭网络以实现**数据通信**及**资源共享**的目的。
**常用的介质**： 双绞线、同轴电缆、光纤、无线等。
**典型特点**： 覆盖的地理范围小（ 几米到几公里），具有**较高的数据传输速率**和**较低的时延**。

#### 7.1.1. 局域网拓扑结构

**总线型**： 以广播形式发送数据， 所有站点都能收到数据。所有站点同时发送数据时会发生冲突，主要传输介质为同轴电缆。

**星形**： 所有站点均连接在中心节点(HUB ) 上， 所有的数据交互均要通过中心节点， —个中心节点容易产生单点故障， 所以通常星形拓扑中的中心节点会有—个备份。

**环形**： 由一系列首尾相连的中继器组成， 每个中继器连接一个站点。需要有某种访问逻辑来控制各个站点的发送顺序， 最常用传输介质为双绞线。轻负载时效率低， 重负载时利用率高。

**树形**： 将多级中心节点(HUB ) 连接起来以扩大网络的规模， 数据可以延链路传输至链路上的任何一个站点。

### 7.2. IEEE 802标准

| 局域网标准       | 描述                                                         |
| ---------------- | ------------------------------------------------------------ |
| IEEE 802.1A      | 局域网体系结构，并定义接口原语                               |
| IEEE 802.1B      | 寻址、网间互连和网络管理                                     |
| **IEEE 802.1d**  | **生成树协议（Spanning Tree Protocol,STP）**                 |
| **IEEE 802.1q**  | **虚拟局域网（Virtual Local Area Network, VLAN）**           |
| **IEEE 802.1s**  | **多生成树协议（Multiple Spanning Tree Protocol,MSTP）**     |
| **IEEE 802.1w**  | **快速生成树协议（Rapid Spanning Tree Protocol, RSTP）**     |
| IEEE 802.2       | 描述逻辑链路控制( LLC )协议，提供OSI数据链路层的上部子层功能，以及介质接入控制( MAC )子层与LLC子层协议间的一致接口 |
| **IEEE 802.3**   | **描述CSMA/CD介质接入控制方法和物理层技术规范**              |
| **IEEE 802.3u**  | **快速以太网（Fast Ethernet）**                              |
| **IEEE 802.3z**  | **千兆以太网（Gigabit Ethernet）**                           |
| **IEEE 802.3ae** | **万兆以太网（10 Gigabit Ethernet）**                        |
| IEEE 802.4       | 描述令牌总线网标准                                           |
| IEEE 802.5       | 描述令牌环网标准                                             |
| IEEE 802.6       | 描述城域网DQDB标准                                           |
| IEEE 802.7       | 描述宽带局域网技术                                           |
| IEEE 802.8       | 描述光纤局域网技术                                           |
| IEEE 802.9       | 描述综合话音/数据局域网( IVD LAN )标准                       |
| IEEE 802.10      | 描述可互操作局域网安全标准( SILS)，定义提供局域网互连的安全机制 |
| **IEEE 802.11**  | **描述无线局域网标准**                                       |
| IEEE 802.12      | 描述交换式局域网标准，定义100Mb/s高速以太网按需优先的介质接入控制协议100VG-ANYLAN |
| IEEE 802.14      | 描述交互式电视网(包括Cable Modem )                           |
| IEEE 802.15      | 无线个人局域网（Personal Area Network,PAN），如**蓝牙**      |
| IEEE 802.16      | 宽带无线接入（Boardband Wireless Access,BWA）                |

### 7.3. 以太网技术-CSMA/CD协议

**载波监听多路访问/冲突检测**：发送数据前先监听信道是否空闲，若空闲，则立即发送数据。在发送数据时，边发送边继续监听。若监听到冲突，则立即停止发送数据，等待一段随机时间再重新尝试。

CSMA/CD 协议避免冲突的过程：

1. **数据发送前监听**
2. **数据发送时边发边监听**
3. **发现冲突立即停发数据**
4. **数据重发**

监听算法：

- **非坚持型监听算法**：信道空闲立刻发送，信道繁忙时，**等待随机时间$t$后再发送**。特点：信道利用率更高，由于随机时间后发送，减少了冲突的概率。可能会出现增加发送时延的问题。
- **1-坚持型监听算法**：信道空闲立刻发送，信道繁忙时**持续监听**，直到**信道空闲后再发送**。特点：有利于抢占信道。可能会导致多次冲突从而降低性能。
- **P-坚持型监听算法**：信道空闲时，以**概率P去发送数据**，以**（1-P）的概率去推迟发送数据**。特点：P概率取值比较困难。

冲突检测：

以太网的端到端往返时延$2t$称为**争用期**，或**碰撞窗口**。

**最短帧长计算公式**：

$$传输时延>=2*传播时延$$

发生冲突后，立刻停止发送，并对信息进行重传。

数据重发：

随机延时重发----截断二进制指数退避算法：

1. 确定基本退避时间；
2. 从离散的整数集合$[0,1,...,(2^{n-1})]$中随机取出一个数，记为$r$。重传应推后的时间为$r$倍的争用期。参数$k$按照$k=Min[重传次数,10]$计算。
3. 当重传次数到达16次仍不能成功时，就丢弃该帧，并向高层报告。

### 7.4. 以太网技术-MAC地址

![](https://static.xiaoliutalk.cn/img/202209192325283.jpg)

MAC地址是由48位（6个字节）组成，对于前8位的最后一位，如果为0，则为**单播地址**，如果为1，则为**组播地址**。

MAC地址通常表示为12个16进制数，组合起来刚好为48位。

### 7.5. 以太网技术-以太网V2帧格式

![](https://static.xiaoliutalk.cn/img/202209192336489.jpg)

**MTU长度**：46~1500字节。

**前同步码**：7个字节，用户使接收端进入同步状态。

**帧开始定界符**：1个字节，标识信息帧开始。

**目的地址，源地址**：目的和源的MAC地址。占用6个字节。

**类型**：表示上层协议，OX0800表示上层协议为IP协议； OX8137表示上层协议为IPX协议。占用两个字节。

**数据**：IP数据报，占用46~1500字节。

**FCS帧校验字段**：采用CRC校验。占用4字节。

MAC帧（以太网帧） **最小帧长为64** 字节， **最大帧长1518**字节。

### 7.6. 以太网技术-网络传输介质

![](https://static.xiaoliutalk.cn/img/202209201651026.jpg)

双绞线分为**非屏蔽双绞线UTP**，**屏蔽双绞线STP** 。屏蔽双绞线抗电磁干扰能力更强，但传输距离更短。

**T568A**：白绿绿白橙蓝白蓝橙白棕棕

**T568B**：白橙橙白绿蓝白蓝绿白棕棕

区别为 1和3，2和6做了调换。

目前网络设备均能自动适应这两种标准，并能自动转换成合适的线序，所以一般只采用T568B的接线方式。



![](https://static.xiaoliutalk.cn/img/202209201933941.jpg)

| 项目     | 距离 | 速度 | 直径 | 端接 | 造价 | 光源       |
| -------- | ---- | ---- | ---- | ---- | ---- | ---------- |
| 单模光纤 | 长   | 快   | 小   | 较难 | 高   | 激光       |
| 多模光纤 | 短   | 慢   | 大   | 较易 | 低   | 发光二极管 |

### 7.7. 以太网技术-以太网命名规则

以太网命名规则：

$$N + 信号 + 传输介质$$

N：以兆为单位数据传输速率。如10，100，1000Mb/s

信号：基带还是宽带。

- **Base**：基带（数字信道）
- **Board**：宽带（模拟信道）

传输介质：标识介质的种类。

- **T**：非屏蔽双绞线 **UTP**。
- **F**：**光纤**（可以是单模或者是多模）。
- **C**：屏蔽双绞线 **STP**。
- **数字**：为同轴电缆及电缆长度（10base5，10base2）。
- **LX**：长距离光模块（一般指**单模光纤**）。
- **SX**：短距离光模块（一般指**多模光纤**）。
- **CX**：**双绞线**。
- **LH**：一般指超长距离光模块。

### 7.8. 以太网技术-快速以太网-802.3u

- 技术特点

  - 100Mbps
  - 相同的帧格式
  - 半双工/全双工
  - 100Base-T
- 传输介质标准
  - 100Base-TX：使用2对**5类UTP** , 一对用于接收， 一对用于发送。**传输距离100m**。
  - 100Base-FX：使用光纤，两芯单模或者多模光纤。**多模光纤传输距离2km。单模光纤传输距离40km。**
  - 100Base-T4：使用3对**4类UTP** , 其中一对用于碰撞检测。**传输距离100m**。
  - 100Base-T2：由100Base-T4升级而来。**传输距离100m**。

### 7.9. 以太网技术-千兆以太网-802.3z

- 技术特点

  - 1000Mbps
  - 相同的帧格式
  - 半双工/全双工
- 传输介质标准
  - 1000Base-T：使用4对**5类UTP** , 最大段长100米( **IEEE802.3ab** )
  - 1000Base-CX：使用2对**STP** , 传输长度25米( IEEE802.3z）
  - 1000Base-LX：使用**多模光纤传输距离550m**， 使用**单模光纤传输距离为5km**( I EEE802.3z )
  - 1000Base-SX：使用**多模光纤传输距离550m**（IEEE802 . 3z )

### 7.10. 以太网技术-万兆以太网-802.3ae

- 技术特点

  - 10000Mbps
  - 相同的帧格式
  - 全双工
- 传输介质标准
  - 10GBase-S：**50um多模光纤，传输距离300m**。**62.5um多模光纤，传输距离65m**。
  - **10GBase-L**：**单模光纤**。**传输距离10km**。
  - **10GBase-E**：**单模光纤**。**传输距离40km**。
  - **10GBase-LX4**：**单模光纤。传输距离10km**。**50um多模光纤，传输距离300m**。**62.5um多模光纤，传输距离300m**。

### 7.11. 以太网技术-冲突域和广播域

**冲突域**： 连接在同一传输介质上的所有工作站的集合。发送消息是有冲突。

**广播域**： 指接收同样广播消息的节点的集合。

|        | 分割冲突域 | 分割广播域 |
| ------ | ---------- | ---------- |
| 集线器 | ✗          | ✗          |
| 交换机 | ✓          | ✗          |
| 路由器 | ✓          | ✓          |

### 7.12. 以太网技术-交换式以太网

交换式以太网是以**交换式集线器**或者**交换机**为中心构建的**星形拓扑**结构网络，利用“ **端口/MAC地址映射表**” 进行数据交换。

**减少冲突**： 交换机将冲突隔绝在每—个端口（即**每个端口都是—个冲突域**），避免了冲突的扩散。

**提升带宽**：接入交换机的每个节点都可以使用全部的带宽，而不是各个节点共享带宽。

- **广播**：如果目标地址在MAC地址表中没有，交换机就向除接收到该数据帧的端口外的其他所有端口广播该数据帧。
- **学习**：MAC地址表是交换机通过学习接收的数据帧的源MAC地址来形成的。
- **转发**：交换机根据MAC地址表**单播**转发数据帧。
- **更新**：交换机MAC地址表的老化时间是**300秒**。

交换机如果发现一个帧的入端和MAC地址表中源MAC地址的所在端口不同，交换机将MAC地址重新学习到新的端口，

### 7.13. 以太网技术-堆叠和级联（未完成）

#### 7.13.1. 级联 



#### 7.13.2. 堆叠

### 7.14. VLAN

VLAN 技术解决了局域网互联时无法限制广播的问题， 每个VLAN一个**广播域**，不同VLAN之间不能通信， 如果需要通信，需要增加三层设备。

### 7.15. IEEE 802.1Q

![](https://static.xiaoliutalk.cn/img/202209212039169.jpg)

其中，VLANID占了12位，$2^{12}=4096$，0和4096都是不可使用的，实际可用的为**4094**个VLAN。

**VLAN划分方法**：

- **基于端口的划分**：静态VLAN
- **基于MAC地址的划分**：动态VLAN
- **基于网络层协议的划分**：动态VLAN
- **基于子网的划分**：动态VLAN
- **基于策略的划分**：如基于MAC+端口进行划分VLAN。动态VLAN

**以太网端口的类型**：

- **Access 端口**：主要用于连接终端，特点是**仅允许一个VLAN**的帧通过。
- **Trunk 端口**：主要用于连接其它交换机端口,特点是**允许多个VLAN**通过，并且**除了缺省VLAN**外,其它VLAN都**带标签通过Trunk端口**。当VLAN为1（**缺省VLAN**）时，通过Trunk端口进行转发时，会把标签去除掉，另外一个交换机收到之后，会打上PVID（**缺省VLAN**），在交换机内部进行转发。
- **Hybrid 端口**：即可以用于连接终端，又可以连接其它交换机、路由器设备，特点是允许一个或多个VLAN的帧通过，并且**可以选择**是**带标签还是不带标签**。

### 7.16. VLAN注册协议-GVRP协议

手工配置的VLAN称为**静态VLAN**，通过GVRP协议创建的VLAN称为**动态VLAN**。GVRP有三种注册模式，不同的模式对静态VLAN和动态VLAN的处理方式也不同。GVRP 的三种注册模式分别为：

- **Normal 模式**：**允许动态VLAN**在端口上注册。**同时发送动态和静态VLAN**的声明信息。
- **Fixed 模式**：**不允许动态VLAN**在端口上注册。**只发送静态VLAN**的声明信息。
- **Forbidden 模式**：**不允许动态VLAN**在端口上注册。**只发送VLAN1**的声明信息。

### 7.17. 生成树协议-STP

> **广播风暴**（broadcast storm）简单的讲是指当广播数据充斥网络无法处理，并占用大量网络带宽，导致正常业务不能运行，甚至彻底瘫痪，这就发生了“广播风暴”。一个数据帧或包被传输到本地网段 （由广播域定义）上的每个节点就是广播；由于网络拓扑的设计和连接问题，或其他原因导致广播在网段内大量复制，传播数据帧，导致网络性能下降，甚至网络瘫痪，这就是广播风暴。

生成树协议(Spanning Tree Protocol) ：

- 在逻辑上断开环路，防止广播风暴的产生。
- 当线路出现故障，断开的接口被激活，恢复通信，起到线路备份的作用。

#### 7.17.1. 生成树协议算法 

生成树协议将环形网络生成无环拓扑的步骤：

<center>选择根网桥-->选择根端口-->选择指定端口-->阻塞非根端口，非指定端口</center>



##### 选举根网桥

**网桥ID**是唯一的，交换机之间选择**桥ID（BID）**值最小的交换机为网络中的根网桥。

**网桥ID**组成：**网桥优先级**（2字节）+**网桥的MAC地址**（6字节）

网桥优先级取值范围：**0~65535**，默认值为**32768**，如果需要调整，必须为**4096的倍数**。

优先级值越小优先级越高， 优先级高的的为根桥。如果优先级相同，选取MAC地址最小的为根网桥。

##### 选举根端口

在**非根网桥上**选取一个**到根网桥最近的端口**。选择步骤：

1. 本端口到**根网桥的路径开销**最低。**带宽越大，路径开销越低**。

2. 路径成本相同，选择直连的**网桥ID最小**的端口。

3. **网桥ID最小**的端口相同，选择直连的**端口ID最小**的端口。

   <center>端口ID =（端口优先级+端口编号）</center>

端口优先级：默认为**128**，如果需要调整，必须为**16的倍数**。越小优先级越高。

端口编号：端口实际的编号。

##### 选举指定端口

**根网桥所有端口都是指定端口**。非根网桥上选择步骤：

1. 本端口**所在网桥到根网桥路径开销最小**。
2. 本端口**所在的网桥的ID**较小。
3. 本**端口ID值**较小。

端口开销规定：10G端口开销为2，1000M端口开销为4，100M端口开销为19，10M端口开销为100

##### 阻塞非根端口，非指定端口

端口选举完毕之后，**候补端口阻塞**（非根端口，非指定端口），并形成逻辑上无环路的树形拓扑结构 ，就消除了网络环路。

##### 生成树协议端口状态

收敛时间为**50s**

![](https://static.xiaoliutalk.cn/img/202209271004535.jpg)

- **禁用**：端口不参与生成树协议，不监听也不发送BPDU，也不转发数据帧。

- **阻塞（Blocking）**：仅监听BPDU, 不转发数据帧，也不学习接受帧的MAC地址，延时20s，防止启动交换机过程中产生交换环路。
- **监听（Listening）**：相互学习BPDU的信息，以便交换机可以学习网络中其他交换机的信息，延时15s。此时不学习MAC帧的地址不转发数据帧。
- **学习（Learning）**：处理学习到的BPDU信息，开始计算生成树协议。 学习MAC地址，建立地址表，但不转发数据帧，该状态维持15s。
- **转发（Forwarding）**：可以发送或监听BPDU（ 用桥协议数据单元来传递交换机之间的生成树协议的信息），可以转发数据帧。

### 7.18. 快速生成树协议-RSTP

**快速生成树协议RTSP** ( Rapid Spanning Tree Protocol ) **IEEE802.1w**：由IEEE802.1d发展而来。是优化版的STP ，大大缩短了端口进入转发状态的延时，从而缩短了网络最终达到拓扑稳定所需要的时间。

- 端口状态只有三个：**丢弃**（将STP中的禁用，监听，阻塞合并而来），**学习**，**转发**。
- 端口角色变为四个：根端口，指定端口，Alternate端口（根端口的替代），Backup端口（指定端口的替代）。

RSTP提出了快速收敛机制：

- **边缘端口机制**：不参与生成树协议计算的端口。一般是**与终端相连**。一般情况下需要网络管理员手动指定。
- **根端口快速切换机制**
- **指定端口快速切换机制**

### 7.19. 多生成树协议-MSTP（需要补充）

多生成树MTSP（Multiple Spanning Tree Protocol）：基于实例计算出多颗生成树，实例间实现负载均衡。

先划分实例，之后再映射VLAN，在实例中去找根网桥，根端口，指定端口实现的负载均衡。

不同实例间使用的是不同的根网桥，根端口。

### 7.20. 以太网通道|链路聚合|端口聚合|ETH-Trunk

将**多条物理链路捆绑成一条逻辑链路**，实现**负载均衡**、提高**带宽容错**（当一条链路失效时，使用其他链路进行通信）。

以太网通道最多可以捆绑8条物理链路，其中物理链路可以是双绞线，也可以是光纤连接。

**以太网通道捆绑规则**：

- 参加捆绑的端口属于**同一个VLAN**。
- 如果端口配置的是中继模式，那么应该在链路两端将通道中的所有端口配置成**相同的中继模式**。
- 所有参与捆绑的端口的**物理参数设置必须相同**。应该有同样的速度和半双工或者全双工配置。

协议：

PAGP（端口聚合协议）：Cisco私有协议

LACP（链路聚合控制协议）：IEEE802.3ad

### 7.21. 无线局域网

无线数据网络种类：无线个人网、无线局域网、无线城域网和无线广域网

| 种类       | 标准                      | 典型应用             | 覆盖范围 |
| ---------- | ------------------------- | -------------------- | -------- |
| 无线个人网 | IEEE 802.15               | 蓝牙                 | <=10m    |
| 无线局域网 | IEEE 802.11               | 无线企业网           | <=100m   |
| 无线城域网 | IEEE 802.16               | 主要用于Internet访问 | 2~10KM   |
| 无线广域网 | IEEE 802.20&3蜂窝移动通信 | 主要用于Internet访问 |          |

无线局域网的优点：

- 灵活性和移动性
- 安装便捷
- 易于进行网络规划和调整
- 故障定位容易
- 易于扩展

无线局域网的两种拓扑结构：

- **Infrastructure结构**（基础设置网络）：所有无线终端通过AP访问骨干网络。类似传统有线星型拓扑方案。
- **Ad Hoc结构**（特殊网络）：该方式是点对点的网络，以无线网卡连接的终端设备可以互相通信。

WLAN标准：

| 标准         | 运行频段         | 主要技术      | 数据速率     | 非重叠信道 |
| ------------ | ---------------- | ------------- | ------------ | ---------- |
| 802.11       | 2.4Ghz           | 扩频通信技术  | 1Mbps和2Mbps | 3          |
| 802.11b      | 2.4Ghz           | HR-DSSS 技术  | 11Mbps       | 3          |
| 802.11a      | 5Ghz             | OFDM 调制技术 | 54Mbps       | 5          |
| 802.11g      | 2.4Ghz           | OFDM 调制技术 | 54Mbps       | 3          |
| **802.11n**  | **2.4Ghz和5Ghz** | MINO和OFDM    | 600Mbps      | 3+5        |
| 802.11ac     | 5Ghz             | MINO和OFDM    | 1Gbps        | 5          |
| **802.11ax** | **2.4Ghz和5Ghz** | MINO和OFDM    | 11Gbps       | 8          |

扩频通信技术是将要发送的信息扩展到一个很宽的频带上，以很宽的信道传送信息，抗干扰能力，抗衰落能力较强，抗阻塞能力也强。包括跳频扩频（FHSS）和直接序列扩频（DSSS）。

![](https://static.xiaoliutalk.cn/img/202209281523754.jpg)



隐蔽站问题：

![](https://static.xiaoliutalk.cn/img/202209281701670.jpg)

其中B 在C的无线电波范围内，但A不在C的无线电波范围内。 此时C 正在向B传送数据，而A也试图向B传送数据。此时，A不能够监听到B 正在忙（因为A在监听信道的时候什么也听不到，所以它会错误的认为此时可以向B传送数据了）。如果A向B传送数据，则将导致冲突。这就是隐蔽站问题。其中C是A的隐蔽站。

暴露站问题：

![](https://static.xiaoliutalk.cn/img/202209291526443.jpg)

其中C在B的无线电波范围内，但D不在B的无线电波范围内。此时B正在传送数据（向A进行传送），而C希望给D发送数据，但是错误地认为该传送过程将会失败，因为C会监听到—次传输，所以它会错误地认为此时不能向D发送数据，这就是暴露站问题。

#### 7.21.1. IEEE802.11 MAC 层协议（CSMA/CA）

因为存在**隐蔽站**和**暴露站**问题，无线局域网不适用CSMA/CD协议，只能使用改进CSMA协议。

CSMA/CA 基本操作过程如下：

- 如果有一个站点要发送数据并且监听到信道忙，则产生一个随机数设置自己的后退计时器并且继续监听。
- 监听到信道空闲后等待 IFS 时间，然后开始计数。 最先计数完成的站点开始发送数据。 
- 其他站点监听到有新的站点开始发送数据后暂停计数，在新的站点数据发送完成后在等待一个IFS 时间继续计数，知道计数完成开始发送数据。

MAC子层：

![](https://static.xiaoliutalk.cn/img/202209291544012.jpg)

- DCF子层在每—个结点使用CSMA机制的分布式接入算法，让每个站通过争用信道来获取发送权。 

- PCF子层使用集中控制的接入算法将发送数据权轮流交给每个站点从而避免了碰撞的产生。（可选）

#### 7.21.2. WLAN安全性

提升WLAN安全性的手段：

- 更改默认设置
- 更新AP的Firmware 
- 屏蔽SSID广播
- 加密和认证
- MAC 地址过滤

#### 7.21.3. 无线局域网组网

胖AP（FAT）：一般指无线路由器，多用于家庭、酒店办公场所等小型网络，功能较全，自带操作系统，设置简单，能实现接入、认证、路由、VPN、地址翻译甚至防火墙功能。

瘦AP（FIT）：去掉路由、DNS、DHCP 服务器等诸多额外的功能， 仅保留无线接入的部分。不能独立工作，设置需要通过专用AC（AP控制器）来完成。

![](https://static.xiaoliutalk.cn/img/202209291604619.jpg)