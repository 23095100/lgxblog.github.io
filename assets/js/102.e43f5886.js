(window.webpackJsonp=window.webpackJsonp||[]).push([[102],{474:function(s,a,t){"use strict";t.r(a);var n=t(1),e=Object(n.a)({},(function(){var s=this,a=s._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h1",{attrs:{id:"ansible基础入门"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#ansible基础入门"}},[s._v("#")]),s._v(" ansible基础入门")]),s._v(" "),a("h2",{attrs:{id:"_1-ansible目录结构"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-ansible目录结构"}},[s._v("#")]),s._v(" 1. ansible目录结构")]),s._v(" "),a("img",{staticStyle:{zoom:"67%"},attrs:{src:"https://static.xiaoliutalk.cn/img/202302131051405.jpg"}}),s._v(" "),a("h2",{attrs:{id:"_2-ansible配置文件解析"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-ansible配置文件解析"}},[s._v("#")]),s._v(" 2. ansible配置文件解析")]),s._v(" "),a("p",[s._v("Ansible的自身配置文件只有一个，即"),a("code",[s._v("ansible.cfg")]),s._v("，Ansible安装好后它默认存放于"),a("code",[s._v("/etc/ansible/")]),s._v("目录下。"),a("code",[s._v("ansible.cfg")]),s._v("配置文件可以存在于多个地方，Ansible读取配置文件的顺序依次是：")]),s._v(" "),a("p",[s._v("当前命令执行目录→用户家目录下的"),a("code",[s._v(".ansible.cfg")]),s._v("→"),a("code",[s._v("/etc/ansible.cfg")]),s._v("，先找到哪个就使用哪个。")]),s._v(" "),a("p",[a("code",[s._v("ansible.cfg")]),s._v("配置文件示例：")]),s._v(" "),a("div",{staticClass:"language-ini line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-ini"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 该类配置下定义常规的连接类配置。")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token section"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token section-name selector"}},[s._v("defaults")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")])]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# inventory = /etc/ansible/hosts                # 定义Inventory")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# library = /usr/share/my_modules/      # 自定义lib库存放目录")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# remote_tmp = $HOME/.ansible/tmp       # 临时文件远程主机存放目录")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# local_tmp = $HOME/.ansible/tmp                # 临时文件本地存放目录")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# forks = 5                             # 默认开启的并发数")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# poll_interval = 15                    # 默认轮询时间间隔")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# sudo_user  = root                     # 默认sudo用户")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ask_sudo_pass = True                  # 是否需要sudo密码")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ask_pass  = True                      # 是否需要密码")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# roles_path = /etc/ansible/roles       # 默认下载的Roles存放的目录")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# host_key_checking = False             # 首次连接是否需要检查key认证，建议设为False")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# timeout = 10                          # 默认超时时间")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# log_path = /var/log/ansible.log       # 执行日志存放目录")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# module_name = command                 # 默认执行的模块")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# action_plugins = /usr/share/ansible/plugins/action # action插件的存放目录")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# callback_plugins = /usr/share/ansible/plugins/callback # callback插件的存放目录")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# connection_plugins = /usr/share/ansible/plugins/connection    # connection插件的")]),s._v("\n                                                                        "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 存放目录")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# lookup_plugins = /usr/share/ansible/plugins/lookup    # lookup插件的存放目录")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# vars_plugins = /usr/share/ansible/plugins/vars        # vars插件的存放目录")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# filter_plugins = /usr/share/ansible/plugins/filter    # filter插件的存放目录")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# test_plugins = /usr/share/ansible/plugins/test        # test插件的存放目录")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# strategy_plugins = /usr/share/ansible/plugins/strategy        # strategy插件的存放目录")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# fact_caching = memory                                 # getfact缓存的主机信息存放方式")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# retry_files_enabled = False")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# retry_files_save_path = ~/.ansible-retry              # 错误重启文件存放目录")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 该部分配置主要针对sudo用户提权的配置。")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token section"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token section-name selector"}},[s._v("privilege_escalation")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")])]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# become=True           # 是否sudo")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# become_method=sudo    # sudo方式")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# become_user=root      # sudo后变为root用户")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# become_ask_pass=False # sudo后是否验证密码")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 主要是SSH连接的一些配置。")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token section"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token section-name selector"}},[s._v("ssh_connection")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")])]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# pipelining = False    # 管道加速功能，需配合requiretty使用方可生效")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ansible连接加速相关配置。该配置项在提升Ansibile连接速度时会涉及，多数保持默认即可。")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token section"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token section-name selector"}},[s._v("accelerate")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")])]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# accelerate_port = 5099                        # 加速连接端口")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# accelerate_timeout = 30                       # 命令执行超时时间，单位秒")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# accelerate_connect_timeout = 5.0      # 连接超时时间，单位秒")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# accelerate_daemon_timeout = 30                # 上一个活动连接的时间，单位分钟")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# accelerate_multi_key = yes")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 配置输出结果的颜色。几乎不用修改。")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token section"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token section-name selector"}},[s._v("colors")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")])]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#highlight = white")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#verbose = blue")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#warn = bright purple")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#error = red")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#debug = dark gray")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#deprecate = purple")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#skip = cyan")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#unreachable = red")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#ok = green")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#changed = yellow")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#diff_add = green")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#diff_remove = red")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#diff_lines = cyan")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br"),a("span",{staticClass:"line-number"},[s._v("37")]),a("br"),a("span",{staticClass:"line-number"},[s._v("38")]),a("br"),a("span",{staticClass:"line-number"},[s._v("39")]),a("br"),a("span",{staticClass:"line-number"},[s._v("40")]),a("br"),a("span",{staticClass:"line-number"},[s._v("41")]),a("br"),a("span",{staticClass:"line-number"},[s._v("42")]),a("br"),a("span",{staticClass:"line-number"},[s._v("43")]),a("br"),a("span",{staticClass:"line-number"},[s._v("44")]),a("br"),a("span",{staticClass:"line-number"},[s._v("45")]),a("br"),a("span",{staticClass:"line-number"},[s._v("46")]),a("br"),a("span",{staticClass:"line-number"},[s._v("47")]),a("br"),a("span",{staticClass:"line-number"},[s._v("48")]),a("br"),a("span",{staticClass:"line-number"},[s._v("49")]),a("br"),a("span",{staticClass:"line-number"},[s._v("50")]),a("br"),a("span",{staticClass:"line-number"},[s._v("51")]),a("br"),a("span",{staticClass:"line-number"},[s._v("52")]),a("br"),a("span",{staticClass:"line-number"},[s._v("53")]),a("br"),a("span",{staticClass:"line-number"},[s._v("54")]),a("br"),a("span",{staticClass:"line-number"},[s._v("55")]),a("br"),a("span",{staticClass:"line-number"},[s._v("56")]),a("br"),a("span",{staticClass:"line-number"},[s._v("57")]),a("br"),a("span",{staticClass:"line-number"},[s._v("58")]),a("br"),a("span",{staticClass:"line-number"},[s._v("59")]),a("br"),a("span",{staticClass:"line-number"},[s._v("60")]),a("br"),a("span",{staticClass:"line-number"},[s._v("61")]),a("br"),a("span",{staticClass:"line-number"},[s._v("62")]),a("br"),a("span",{staticClass:"line-number"},[s._v("63")]),a("br")])]),a("h2",{attrs:{id:"_3-ansible命令用法"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-ansible命令用法"}},[s._v("#")]),s._v(" 3. ansible命令用法")]),s._v(" "),a("p",[s._v("ansible的通信默认基于SSH，因此我们需要对主机先进行认证。ansible认证方式有密码认证和公私钥认证两种方式。这里采用公私钥验证方式进行配置示范。")]),s._v(" "),a("h3",{attrs:{id:"_3-1-配置公私钥验证"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-1-配置公私钥验证"}},[s._v("#")]),s._v(" 3.1. 配置公私钥验证")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 随机生成公私钥对，ssh-keygen是Linux下认证密钥生成、管理和转换工具，详细用法可参考其man文档")]),s._v("\nssh-keygen  "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-N")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-b")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4096")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-t")]),s._v(" rsa "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-f")]),s._v(" /root/.ssh/ansible.rsa\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 为本机添加密钥认证")]),s._v("\nssh-copy-id "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-i")]),s._v(" /root/.ssh/ansible.rsa root@localhost\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 输入如下命令尝试免密码登录")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ssh")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-i")]),s._v(" /root/.ssh/ansible.rsa root@localhost\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br")])]),a("p",[s._v("实际应用中为方便起见，一般会使用"),a("strong",[s._v("非root用户")]),s._v("生成默认文件名为"),a("code",[s._v("id_rsa")]),s._v("、"),a("code",[s._v("id_rsa.pub")]),s._v("的密钥对，在使用时通过"),a("code",[s._v("sudo")]),s._v("的方式获取权限。")]),s._v(" "),a("h3",{attrs:{id:"_3-2-ansible命令使用"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-ansible命令使用"}},[s._v("#")]),s._v(" 3.2. ansible命令使用")]),s._v(" "),a("p",[s._v("ansible命令主要在如下场景使用：")]),s._v(" "),a("ul",[a("li",[a("p",[s._v("非固化需求")])]),s._v(" "),a("li",[a("p",[s._v("临时一次性操作")])]),s._v(" "),a("li",[a("p",[s._v("二次开发接口调用")])])]),s._v(" "),a("p",[s._v("ansible的命令使用格式如下：")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("ansible "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("host-pattern"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("-m 模块名称"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("-a 参数"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("选项"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("table",[a("thead",[a("tr",[a("th",[s._v("选项")]),s._v(" "),a("th",[s._v("描述")])])]),s._v(" "),a("tbody",[a("tr",[a("td",[s._v("-a '参数'")]),s._v(" "),a("td",[s._v("需要传递给模块的参数。")])]),s._v(" "),a("tr",[a("td",[s._v("-b")]),s._v(" "),a("td",[s._v("以更高权限运行命令。（默认为root）")])]),s._v(" "),a("tr",[a("td",[s._v("--user=username")]),s._v(" "),a("td",[s._v("使用此"),a("strong",[s._v("username")]),s._v("进行连接主机。")])]),s._v(" "),a("tr",[a("td",[s._v("--become-user=username")]),s._v(" "),a("td",[s._v("指定主机以"),a("strong",[s._v("username")]),s._v("运行命令。")])]),s._v(" "),a("tr",[a("td",[s._v("-C")]),s._v(" "),a("td",[s._v("模拟真实的运行情况在主机上，但是不对主机进行更改内容。")])]),s._v(" "),a("tr",[a("td",[s._v("-m module")]),s._v(" "),a("td",[s._v("指定运行模块的名称。")])])])]),s._v(" "),a("p",[s._v("具体示例如下：")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 列出all组下的所有主机")]),s._v("\nansible all --list-hosts\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 以root用户执行ping存活检测")]),s._v("\nansible all "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-m")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ping")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--user")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("root\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 以ansible用户sudo至root执行ping存活检测")]),s._v("\nansible all "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-m")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ping")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--user")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("ansible "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-b")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 以root用户sudo至ansible用户执行ping存活检测")]),s._v("\nansible all "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-m")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ping")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--user")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("root "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-b")]),s._v(" --become-user"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("ansible\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br")])]),a("h2",{attrs:{id:"_4-ansible系列命令用法"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-ansible系列命令用法"}},[s._v("#")]),s._v(" 4. ansible系列命令用法")]),s._v(" "),a("h3",{attrs:{id:"_4-1-ansible-galaxy"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-1-ansible-galaxy"}},[s._v("#")]),s._v(" 4.1. ansible-galaxy")]),s._v(" "),a("p",[a("code",[s._v("ansible-galaxy")]),s._v("的功能可以简单地理解为"),a("code",[s._v("GitHub")]),s._v("或"),a("code",[s._v("PIP")]),s._v("的功能，通过"),a("code",[s._v("ansible-galaxy")]),s._v("命令，我们可以根据下载量和关注量等信息，查找和安装优秀的"),a("code",[s._v("Roles")]),s._v("。")]),s._v(" "),a("p",[s._v("在"),a("code",[s._v("ansible-galaxy")]),s._v("上，我们可以上传和下载"),a("code",[s._v("Roles")]),s._v("，这里也是优秀"),a("code",[s._v("Roles")]),s._v("的聚集地，下载地址为"),a("a",{attrs:{href:"https://galaxy.ansible.com/",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://galaxy.ansible.com"),a("OutboundLink")],1),s._v(" 。")]),s._v(" "),a("p",[s._v("ansible-galaxy命令使用格式如下：")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("ansible-galaxy "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("init"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("info"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("list"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("remove"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("--help"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("options"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("table",[a("thead",[a("tr",[a("th",[s._v("选项")]),s._v(" "),a("th",[s._v("描述")])])]),s._v(" "),a("tbody",[a("tr",[a("td",[s._v("init")]),s._v(" "),a("td",[s._v("初始化本地的Roles配置，以备上传Roles至galaxy。")])]),s._v(" "),a("tr",[a("td",[s._v("info")]),s._v(" "),a("td",[s._v("列表指定Role的详细信息。")])]),s._v(" "),a("tr",[a("td",[s._v("install")]),s._v(" "),a("td",[s._v("下载并安装galaxy指定的Roles到本地。")])]),s._v(" "),a("tr",[a("td",[s._v("list")]),s._v(" "),a("td",[s._v("列出本地已下载的Roles。")])]),s._v(" "),a("tr",[a("td",[s._v("remove")]),s._v(" "),a("td",[s._v("删除本地已下载的Roles。")])])])]),s._v(" "),a("h3",{attrs:{id:"_4-2-ansible-pull"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-2-ansible-pull"}},[s._v("#")]),s._v(" 4.2. ansible-pull")]),s._v(" "),a("p",[s._v("该指令的使用涉及Ansible的另一种工作模式：pull模式（Ansible默认使用push模式）。这和通常使用的push模式工作机理刚好相反，其适用于以下场景：")]),s._v(" "),a("ul",[a("li",[s._v("你有数量巨大的机器需要配置，即使使用高并发线程依旧要花费很多时间。")]),s._v(" "),a("li",[s._v("你要在刚启动的、没有网络连接的主机上运行Ansible。")])]),s._v(" "),a("p",[s._v("ansible-pull命令使用格式如下：")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("ansible-pull "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("options"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("playbook.yml"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("通过ansible-pull结合Git和crontab一并实现，其原理如下：通过crontab定期拉取指定的Git版本到本地，并以指定模式自动运行预先制订好的指令。\n具体示例参考如下：")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("*/20 * * * * root /usr/local/bin/ansible-pull "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-o")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-C")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2.1")]),s._v(".0 "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-d")]),s._v(" /srv/www/king-gw/ "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-i")]),s._v(" /etc/ansible/hosts "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-U")]),s._v(" git:// git.kingifa.com/king-gw-ansiblepull "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">>")]),s._v(" /var/log/ansible-pull.log "),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("2")]),s._v(">")]),a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("&1")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("ansible-pull通常在配置大批量机器的场景下会使用，灵活性稍有欠缺，但效率几乎可以无限提升，对运维人员的技术水平和前瞻性规划有较高要求。")]),s._v(" "),a("h3",{attrs:{id:"_4-3-ansible-doc"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-3-ansible-doc"}},[s._v("#")]),s._v(" 4.3. ansible-doc")]),s._v(" "),a("p",[a("code",[s._v("ansible-doc")]),s._v("是"),a("code",[s._v("ansible")]),s._v("模块文档说明，针对每个模块都有详细的用法说明及应用案例介绍。")]),s._v(" "),a("h3",{attrs:{id:"_4-4-ansible-playbook"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-4-ansible-playbook"}},[s._v("#")]),s._v(" 4.4. ansible-playbook")]),s._v(" "),a("p",[a("code",[s._v("ansible-playbook")]),s._v("通过读取预先编写好的"),a("code",[s._v("playbook")]),s._v("文件实现批量管理。")]),s._v(" "),a("p",[s._v("命令使用方式如下：")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("ansible-playbook playbook.yml\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("h3",{attrs:{id:"_4-5-ansible-vault"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-5-ansible-vault"}},[s._v("#")]),s._v(" 4.5. ansible-vault")]),s._v(" "),a("p",[s._v("ansible-vault主要用于配置文件加密。")]),s._v(" "),a("p",[s._v("命令使用方式如下：")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("ansible-vault "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("create"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("decrypt"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("edit"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("encrypt"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("rekey"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("view"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("--help"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("options"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" file_name\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("具体示例如下：")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 加密a.yml文件")]),s._v("\nansible-vault encrypt a.yml\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 解密a.yml文件")]),s._v("\nansible-vault decrypt a.yml\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("h2",{attrs:{id:"_5-ansible-inventory配置及详解"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-ansible-inventory配置及详解"}},[s._v("#")]),s._v(" 5. ansible Inventory配置及详解")]),s._v(" "),a("p",[a("code",[s._v("Inventory")]),s._v("是"),a("code",[s._v("ansible")]),s._v("管理主机信息的配置文件，相当于系统HOSTS文件的功能，默认存放在"),a("code",[s._v("/etc/ansible/hosts")]),s._v("。可以在使用时通过"),a("code",[s._v("–i")]),s._v("或"),a("code",[s._v("--inventory-file")]),s._v("指定读取对应的"),a("code",[s._v("Inventory")]),s._v("文件。")]),s._v(" "),a("h3",{attrs:{id:"_5-1-定义主机和组"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-1-定义主机和组"}},[s._v("#")]),s._v(" 5.1. 定义主机和组")]),s._v(" "),a("div",{staticClass:"language-ini line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-ini"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Inventory可以直接为IP地址")]),s._v("\n192.168.37.149\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Inventory同样支持Hostname的方式，后跟冒号加数字表示端口号，默认22号端口")]),s._v("\nntp.magedu.com:2222\nnfs.magedu.com\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 中括号内的内容表示一个分组的开始，紧随其后的主机均属于该组成员，空行后的主机亦属于该组")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token section"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token section-name selector"}},[s._v("websevers")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")])]),s._v("\nweb1.magedu.com\nweb2.magedu.com\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# [10:20]表示10～20之间的所有数字（包括10和20），即表示web10.magedu.com、web11.magedu.com……web20.magedu.com的所有主机")]),s._v("\nweb[10:20].magedu.com\n"),a("span",{pre:!0,attrs:{class:"token section"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token section-name selector"}},[s._v("dbservers")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")])]),s._v("\ndb-a.magedu.com\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# [b:f]表示b到f之间的所有数字（包括b和f），即表示db-b.magedu.com、db-e.magedu.com……db-f.magedu.com的所有主机")]),s._v("\ndb-[b:f].magedu.com\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br")])]),a("h3",{attrs:{id:"_5-2-定义主机变量"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-2-定义主机变量"}},[s._v("#")]),s._v(" 5.2. 定义主机变量")]),s._v(" "),a("p",[s._v("在定义主机时为其添加主机变量，以便在"),a("code",[s._v("Playbook")]),s._v("中使用针对某一主机的个性化要求。")]),s._v(" "),a("div",{staticClass:"language-ini line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-ini"}},[a("code",[a("span",{pre:!0,attrs:{class:"token section"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token section-name selector"}},[s._v("webservers")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")])]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 自定义http_port的端口号为808，配置maxRequestsPerChild为801")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("web1.magedu.com http_port")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("808 maxRequestsPerChild=801")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("h3",{attrs:{id:"_5-3-定义组变量"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-3-定义组变量"}},[s._v("#")]),s._v(" 5.3. 定义组变量")]),s._v(" "),a("p",[s._v("赋予指定组内所有主机在"),a("code",[s._v("Playbook")]),s._v("中可用的变量。")]),s._v(" "),a("div",{staticClass:"language-ini line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-ini"}},[a("code",[a("span",{pre:!0,attrs:{class:"token section"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token section-name selector"}},[s._v("groupservers")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")])]),s._v("\nweb1.magedu.com\nweb2.magedu.com\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 定义groupservers组中所有主机ntp_server值为ntp.magedu.com")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token section"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token section-name selector"}},[s._v("groupservers:vars")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")])]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("ntp_server")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("ntp.magedu.com")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br")])]),a("h3",{attrs:{id:"_5-4-定义组嵌套及组变量"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-4-定义组嵌套及组变量"}},[s._v("#")]),s._v(" 5.4. 定义组嵌套及组变量")]),s._v(" "),a("p",[s._v("组还可以包含其他的组（嵌套），并且也可以向组中的主机指定变量。这种方式在业务日常使用中并不常见，大家了解其用法即可。")]),s._v(" "),a("div",{staticClass:"language-ini line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-ini"}},[a("code",[a("span",{pre:!0,attrs:{class:"token section"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token section-name selector"}},[s._v("apache")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")])]),s._v("\nhttpd1.magedu.com\nhttpd2.magedu.com\n\n"),a("span",{pre:!0,attrs:{class:"token section"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token section-name selector"}},[s._v("nginx")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")])]),s._v("\nngx1.magedu.com\nngx2.magedu.com\n\n"),a("span",{pre:!0,attrs:{class:"token section"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token section-name selector"}},[s._v("webservers:children")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")])]),s._v("\napache\nnginx\n\n"),a("span",{pre:!0,attrs:{class:"token section"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token section-name selector"}},[s._v("webservers:vars")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")])]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("ntp_server")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("ntp.magedu.com")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br")])]),a("h3",{attrs:{id:"_5-5-多重变量定义"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-5-多重变量定义"}},[s._v("#")]),s._v(" 5.5. 多重变量定义")]),s._v(" "),a("p",[s._v("变量也可以独立于"),a("code",[s._v("Inventory")]),s._v("文件之外单独存储到"),a("code",[s._v("YAML")]),s._v("格式的配置文件中。")]),s._v(" "),a("p",[a("code",[s._v("ansible")]),s._v("会按照下列路径来寻找配置文件：")]),s._v(" "),a("table",[a("thead",[a("tr",[a("th",[s._v("路径名")]),s._v(" "),a("th",[s._v("备注")])])]),s._v(" "),a("tbody",[a("tr",[a("td",[s._v("/etc/ansible/hosts")]),s._v(" "),a("td",[s._v("Inventory配置文件")])]),s._v(" "),a("tr",[a("td"),s._v(" "),a("td",[s._v("Playbook中vars定义的区域")])]),s._v(" "),a("tr",[a("td"),s._v(" "),a("td",[s._v("Roles中vars目录下的文件")])]),s._v(" "),a("tr",[a("td"),s._v(" "),a("td",[s._v("Roles同级目录group_vars和hosts_vars目录下的文件")])])])]),s._v(" "),a("h2",{attrs:{id:"_6-ansible与正则表达式"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_6-ansible与正则表达式"}},[s._v("#")]),s._v(" 6. ansible与正则表达式")]),s._v(" "),a("p",[s._v("其Patterns功能等同于正则表达式，语法使用也和正则类同，该功能同样支持Ansible-playbook。")]),s._v(" "),a("p",[s._v("命令使用格式如下：")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("ansible "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("pattern_goes_here"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-m")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("module_name"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-a")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("arguments"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("具体示例如下：")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# all和*功能相同，但*号需引起来")]),s._v("\nansible all –m "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ping")]),s._v("\nansible "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"*"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-m")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ping")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 需要同时对多台主机或多个组同时执行，相互之间用“:”（冒号）分隔")]),s._v("\nansible "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"web1:web2"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-m")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ping")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 逻辑非用感叹号（!）表示，针对多重条件的匹配规则，如：所有在webservers组但不在phoenix组的主机")]),s._v("\nansible "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"webservers:!phoenix"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-m")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ping")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 逻辑与（&），如：webservers组和staging组中同时存在的主机")]),s._v("\nansible "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"webservers:&staging"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-m")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ping")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 多条件组合：多条件的复杂组合，使用频率不高，如：webservers和dbservers两个组中的所有主机在staging组中存在且在phoenix组中不存在的主机")]),s._v("\nansible "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"webservers:dbservers:&staging:!phoenix"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-m")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ping")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Python字符串域切割：底层基于Python，因此也支持域切割。")]),s._v("\nansible "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"webservers[0]"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-m")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ping")]),s._v("\nansible "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"webservers[0:2]"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-m")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ping")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 完整支持正则匹配：“~”开始表示正则匹配。如：检测Inventory中所有以192.168开头的服务器存活信息")]),s._v("\nansible ~192"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v(".168"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("."),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("-9"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("."),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("-9"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(","),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-m")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ping")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br")])])])}),[],!1,null,null,null);a.default=e.exports}}]);