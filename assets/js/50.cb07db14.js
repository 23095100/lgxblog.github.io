(window.webpackJsonp=window.webpackJsonp||[]).push([[50],{424:function(a,s,t){"use strict";t.r(s);var e=t(1),n=Object(e.a)({},(function(){var a=this,s=a._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[s("h1",{attrs:{id:"kubernetes调度基础"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#kubernetes调度基础"}},[a._v("#")]),a._v(" kubernetes调度基础")]),a._v(" "),s("h2",{attrs:{id:"_1-命名空间"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-命名空间"}},[a._v("#")]),a._v(" 1. 命名空间")]),a._v(" "),s("blockquote",[s("p",[s("strong",[a._v("命名空间（Namespace）")]),a._v(" 提供一种机制，将同一集群中的资源划分为相互隔离的组。")])]),a._v(" "),s("p",[a._v("命名空间作用域仅针对带有命名空间的"),s("a",{attrs:{href:"https://kubernetes.io/zh-cn/docs/concepts/overview/working-with-objects/#kubernetes-objects",target:"_blank",rel:"noopener noreferrer"}},[a._v("对象"),s("OutboundLink")],1),a._v("， （例如 Deployment、Service 等），这种作用域对集群范围的对象 （例如 StorageClass、Node、PersistentVolume 等）不适用。")]),a._v(" "),s("p",[a._v("简单来说，通过命名空间我们可以将同一集群中的资源分为开发，测试，正式环境，并且通过区分命名空间可以包含同名的资源。")]),a._v(" "),s("h3",{attrs:{id:"_1-1-列出命名空间"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-1-列出命名空间"}},[a._v("#")]),a._v(" 1.1. 列出命名空间")]),a._v(" "),s("p",[a._v("使用以下命令来列出集群中的所有命名空间：")]),a._v(" "),s("div",{staticClass:"language-bash line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[a._v("kubectl get namespaces\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])]),s("p",[a._v("使用以下命令来列出集群中的指定命名空间的所有pod：")]),a._v(" "),s("div",{staticClass:"language-bash line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[a._v("kubectl get pods "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-n")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("NAMESPACE"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v("\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])]),s("p",[a._v("我们可以通过 "),s("code",[a._v("-n")]),a._v(" 或者 "),s("code",[a._v("--namespace")]),a._v(" 指定想查看的命名空间。")]),a._v(" "),s("h3",{attrs:{id:"_1-2-切换命令行的命名空间"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-2-切换命令行的命名空间"}},[a._v("#")]),a._v(" 1.2. 切换命令行的命名空间")]),a._v(" "),s("p",[a._v("在新版本的 Kubernetes 中，"),s("code",[a._v("kubectl")]),a._v(" 的默认命名空间已经不再是 "),s("code",[a._v("default")]),a._v("，而是用户的当前命名空间。这是因为 Kubernetes 强烈建议您在不同的命名空间中隔离应用程序和资源，因此 "),s("code",[a._v("kubectl")]),a._v(" 默认使用用户当前的命名空间来提高生产力。")]),a._v(" "),s("p",[a._v("使用以下命令来查看当前所在的命名空间：")]),a._v(" "),s("div",{staticClass:"language-bash line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[a._v("kubectl config view "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--minify")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--output")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v("'jsonpath={..namespace}'")]),a._v("\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])]),s("p",[a._v("使用以下命令来切换命令行的命名空间：")]),a._v(" "),s("div",{staticClass:"language-bash line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[a._v("kubectl config set-context "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--current")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--namespace")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("NAMESPACE"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v("\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])]),s("h3",{attrs:{id:"_1-3-创建命名空间"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-3-创建命名空间"}},[a._v("#")]),a._v(" 1.3. 创建命名空间")]),a._v(" "),s("h4",{attrs:{id:"_1-3-1-通过文件创建"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-3-1-通过文件创建"}},[a._v("#")]),a._v(" 1.3.1. 通过文件创建")]),a._v(" "),s("p",[a._v("可以通过自定义yaml文件进行创建命名空间：")]),a._v(" "),s("div",{staticClass:"language-yaml line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("apiVersion")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" v1\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("kind")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" Namespace\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("metadata")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" test\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br")])]),s("p",[a._v("使用以下命令来通过文件创建test命名空间：")]),a._v(" "),s("div",{staticClass:"language-bash line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[a._v("kubectl create "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-f")]),a._v(" test.yaml\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])]),s("h4",{attrs:{id:"_1-3-2-通过命令行创建"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-3-2-通过命令行创建"}},[a._v("#")]),a._v(" 1.3.2. 通过命令行创建")]),a._v(" "),s("p",[a._v("也可以使用以下命令通过命令行创建命名空间：")]),a._v(" "),s("div",{staticClass:"language-bash line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[a._v("kubectl create namespace "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("test")]),a._v("\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])]),s("h3",{attrs:{id:"_1-4-删除命名空间"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-4-删除命名空间"}},[a._v("#")]),a._v(" 1.4. 删除命名空间")]),a._v(" "),s("p",[s("strong",[a._v("删除命名空间")])]),a._v(" "),s("p",[a._v("当删除整个命名空间时，"),s("strong",[a._v("Pod将会伴随命名空间自动删除")]),a._v("，可以使用以下命令删除命名空间：")]),a._v(" "),s("div",{staticClass:"language-bash line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[a._v("kubectl delete namespace "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("test")]),a._v("\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])]),s("p",[s("strong",[a._v("删除命名空间中的Pod")])]),a._v(" "),s("p",[a._v("使用"),s("code",[a._v("--all")]),a._v("选项删除对应命名空间中的所有Pod：")]),a._v(" "),s("div",{staticClass:"language-bash line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[a._v("kubectl delete pod "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--all")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-n")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("test")]),a._v("\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])]),s("p",[s("strong",[a._v("删除命名空间中的所有资源（几乎）")])]),a._v(" "),s("p",[a._v("删除当前命名空间中的所有资源，包括Deployment、ReplicaSet、pod等，以及我们创建的所有service，但是不包含集群范围内的对象，如PersistentVolume：")]),a._v(" "),s("div",{staticClass:"language-bash line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[a._v("kubectl delete all "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--all")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-n")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("test")]),a._v("\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])]),s("h2",{attrs:{id:"_2-标签和注解"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-标签和注解"}},[a._v("#")]),a._v(" 2. 标签和注解")]),a._v(" "),s("blockquote",[s("p",[s("strong",[a._v("标签（Labels）")]),a._v(" 是附加到 Kubernetes "),s("a",{attrs:{href:"https://kubernetes.io/zh-cn/docs/concepts/overview/working-with-objects/#kubernetes-objects",target:"_blank",rel:"noopener noreferrer"}},[a._v("对象"),s("OutboundLink")],1),a._v("（比如 Pod）上的键值对。")])]),a._v(" "),s("p",[a._v("在部署实际应用程序时，随着pod数量的增加，我们就需要一种标准，而标签可以将Pod组织成群体的方式，仅通过一次操作对某一个组的资源进行操作，如Pod等等。")]),a._v(" "),s("p",[a._v("标签是不仅可以组织pod，也可以组织"),s("strong",[a._v("其他所有的Kubernetes资源")]),a._v("。")]),a._v(" "),s("h3",{attrs:{id:"_2-1-创建-修改标签"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-创建-修改标签"}},[a._v("#")]),a._v(" 2.1. 创建/修改标签")]),a._v(" "),s("h4",{attrs:{id:"_2-1-通过文件创建-修改"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-通过文件创建-修改"}},[a._v("#")]),a._v(" 2.1. 通过文件创建/修改")]),a._v(" "),s("p",[a._v("在之前的Pod文章中，我们创建Pod时通过 "),s("code",[a._v("metadata.labels")]),a._v(" 指定了一些标签：")]),a._v(" "),s("div",{staticClass:"language-yaml line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[a._v("  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("labels")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\t                               "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 可选，标签选择器，一般用于Selector")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("app")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" nginx               \n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("role")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" frontend                       "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 可选，标签，可以写多个")]),a._v("\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br")])]),s("p",[a._v("Pod创建完成后，通过以下命令查看所有Pod的标签：")]),a._v(" "),s("div",{staticClass:"language-bash line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[a._v("kubectl get pod --show-labels\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])]),s("div",{staticClass:"center-container"},[s("p",[s("img",{attrs:{src:"https://static.xiaoliutalk.cn/img/202308031813305.png",alt:""}})])]),s("h4",{attrs:{id:"_2-1-通过命令行创建-修改"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-通过命令行创建-修改"}},[a._v("#")]),a._v(" 2.1. 通过命令行创建/修改")]),a._v(" "),s("p",[a._v("也可以在现有pod上进行添加标签：")]),a._v(" "),s("div",{staticClass:"language-bash line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[a._v("kubectl label pod nginx "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("env")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("test\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])]),s("p",[a._v("修改标签：")]),a._v(" "),s("div",{staticClass:"language-bash line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[a._v("kubectl label pod nginx "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("env")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("prod "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--overwrite")]),a._v("\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])]),s("p",[a._v("查看标签时可以通过 "),s("code",[a._v("-L")]),a._v(" 指定标签作为显示的一列：")]),a._v(" "),s("div",{staticClass:"language-env line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("kubectl get pod -L env,app\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])]),s("div",{staticClass:"center-container"},[s("p",[s("img",{attrs:{src:"https://static.xiaoliutalk.cn/img/202308031635621.png",alt:""}})])]),s("ul",[s("li",[s("a",{attrs:{href:"https://kubernetes.io/zh-cn/docs/concepts/overview/working-with-objects/common-labels/",target:"_blank",rel:"noopener noreferrer"}},[a._v("推荐使用的标签"),s("OutboundLink")],1)])]),a._v(" "),s("h3",{attrs:{id:"_2-2-标签选择器"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-标签选择器"}},[a._v("#")]),a._v(" 2.2. 标签选择器")]),a._v(" "),s("p",[a._v("标签选择器主要用于"),s("strong",[a._v("资源的匹配")]),a._v("，只有符合条件的资源才会被调用或使用，可以使用该方式对集群中的各类资源进行分配。")]),a._v(" "),s("p",[a._v("可以使用 "),s("code",[a._v("=")]),a._v("、"),s("code",[a._v("==")]),a._v(" 和 "),s("code",[a._v("!=")]),a._v(" 三种运算符进行匹配，并通过 "),s("code",[a._v(",")]),a._v(" 进行过滤。")]),a._v(" "),s("p",[a._v("也可以使用 "),s("code",[a._v("in")]),a._v("、"),s("code",[a._v("notin")]),a._v(" 和 "),s("code",[a._v("exists")]),a._v(" 三种语句进行过滤，本质上两种匹配方式区别不大。")]),a._v(" "),s("p",[a._v("查找标签key为 "),s("code",[a._v("ENV")]),a._v(" 值等于 "),s("code",[a._v("prod")]),a._v(" 并且标签key为 "),s("code",[a._v("app")]),a._v(" 值等于 "),s("code",[a._v("nginx")]),a._v(" 的资源：")]),a._v(" "),s("div",{staticClass:"language-bash line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[a._v("kubectl get pods "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-l")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v("'ENV=prod,app=nginx'")]),a._v(" --show-labels\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])]),s("p",[a._v("查找标签key为 "),s("code",[a._v("ENV")]),a._v(" 值等于 "),s("code",[a._v("prod")]),a._v(" 或者 "),s("code",[a._v("test")]),a._v(" 的资源：")]),a._v(" "),s("div",{staticClass:"language-bash line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[a._v("kubectl get pods "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-l")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v("'ENV in (prod,test)'")]),a._v(" --show-labels\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])]),s("h3",{attrs:{id:"_2-3-注解"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-3-注解"}},[a._v("#")]),a._v(" 2.3. 注解")]),a._v(" "),s("blockquote",[s("p",[a._v("使用 Kubernetes 注解为"),s("a",{attrs:{href:"https://kubernetes.io/zh-cn/docs/concepts/overview/working-with-objects/#kubernetes-objects",target:"_blank",rel:"noopener noreferrer"}},[a._v("对象"),s("OutboundLink")],1),a._v("附加任意的非标识的元数据。")])]),a._v(" "),s("p",[a._v("注解并不是为了保存标识信息而存在的，可以通过对每个pod或其他API对象添加注解来为其添加说明，以便每个使用该集群的人都可以快速查找有关每个单独对象的信息。")]),a._v(" "),s("p",[a._v("通过之前创建的nginxPod查看注解：")]),a._v(" "),s("div",{staticClass:"language-bash line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[a._v("kubectl get pod nginx "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-o")]),a._v(" yaml "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("|")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("grep")]),a._v(" annotations "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-A")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("5")]),a._v("\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])]),s("div",{staticClass:"center-container"},[s("p",[s("img",{attrs:{src:"https://static.xiaoliutalk.cn/img/202308111835950.png",alt:""}})])]),s("p",[a._v("Pod在创建时会自动添加一些注解。我们也可以手动添加注解：")]),a._v(" "),s("div",{staticClass:"language-bash line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[a._v("kubectl annotate pod nginx imageregistry: "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"https://hub.docker.com/"')]),a._v("\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])]),s("p",[a._v("再次查看注解，发现已经成功添加。")]),a._v(" "),s("h2",{attrs:{id:"_3-replicationcontroller和replicaset"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-replicationcontroller和replicaset"}},[a._v("#")]),a._v(" 3. ReplicationController和ReplicaSet")]),a._v(" "),s("h3",{attrs:{id:"_3-1-replicationcontroller-已弃用"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-1-replicationcontroller-已弃用"}},[a._v("#")]),a._v(" 3.1. ReplicationController（已弃用）")]),a._v(" "),s("blockquote",[s("p",[s("strong",[a._v("ReplicationController")]),a._v(" 确保在任何时候都有特定数量的 Pod 副本处于运行状态。换句话说，ReplicationController 确保一个 Pod 或一组同类的 Pod 总是可用的。")])]),a._v(" "),s("p",[a._v("ReplicationController总是会"),s("strong",[a._v("保障Pod的数量达到期望值")]),a._v("，Pod 数量过多时，ReplicationController 会终止多余的 Pod。当 Pod 数量太少时，ReplicationController 将会启动新的 Pod。")]),a._v(" "),s("p",[a._v("新建 "),s("code",[a._v("ReplicationController.yml")]),a._v(" 如下：")]),a._v(" "),s("div",{staticClass:"language-yaml line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("apiVersion")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" v1\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("kind")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" ReplicationController\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("metadata")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" nginx\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("spec")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("replicas")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("3")]),a._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("selector")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("app")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" nginx\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("template")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("metadata")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" nginx\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("labels")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("app")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" nginx\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("spec")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("containers")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" nginx\n          "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("image")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" nginx"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("latest\n          "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("ports")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n            "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("containerPort")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("80")]),a._v("\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br"),s("span",{staticClass:"line-number"},[a._v("7")]),s("br"),s("span",{staticClass:"line-number"},[a._v("8")]),s("br"),s("span",{staticClass:"line-number"},[a._v("9")]),s("br"),s("span",{staticClass:"line-number"},[a._v("10")]),s("br"),s("span",{staticClass:"line-number"},[a._v("11")]),s("br"),s("span",{staticClass:"line-number"},[a._v("12")]),s("br"),s("span",{staticClass:"line-number"},[a._v("13")]),s("br"),s("span",{staticClass:"line-number"},[a._v("14")]),s("br"),s("span",{staticClass:"line-number"},[a._v("15")]),s("br"),s("span",{staticClass:"line-number"},[a._v("16")]),s("br"),s("span",{staticClass:"line-number"},[a._v("17")]),s("br"),s("span",{staticClass:"line-number"},[a._v("18")]),s("br"),s("span",{staticClass:"line-number"},[a._v("19")]),s("br")])]),s("p",[a._v("使用kubectl apply命令从YAML文件创建ReplicationController：")]),a._v(" "),s("div",{staticClass:"language-yaml line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[a._v("kubectl apply "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v("f ReplicationController.yml\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])]),s("p",[a._v("查看ReplicationController：")]),a._v(" "),s("div",{staticClass:"language-bash line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[a._v("kubectl get replicationcontrollers\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])]),s("div",{staticClass:"center-container"},[s("p",[s("img",{attrs:{src:"https://static.xiaoliutalk.cn/img/202308081139746.png",alt:""}})])]),s("ul",[s("li",[s("strong",[a._v("DESIRED")]),a._v("：用户期望的Pod副本个数（spec.replicas的值）。")]),a._v(" "),s("li",[s("strong",[a._v("CURRENT")]),a._v("：当前处于Running状态的Pod的个数。")]),a._v(" "),s("li",[s("strong",[a._v("READY")]),a._v("：当前已经可用的Pod的个数，即健康检查处于正确状态的Pod的个数。")])]),a._v(" "),s("h3",{attrs:{id:"_3-2-replicaset"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-replicaset"}},[a._v("#")]),a._v(" 3.2. ReplicaSet")]),a._v(" "),s("blockquote",[s("p",[a._v("ReplicaSet 的目的是维护一组在任何时候都处于运行状态的 Pod 副本的稳定集合。 因此，它通常用来保证给定数量的、完全相同的 Pod 的可用性。")])]),a._v(" "),s("p",[a._v("ReplicaSet的作用与ReplicationController相同，都是"),s("strong",[a._v("保障Pod的数量达到期望值")]),a._v("，但是两者区别就是ReplicaSet支持"),s("strong",[a._v("更强大的标签选择器")]),a._v("。")]),a._v(" "),s("p",[a._v("新建 "),s("code",[a._v("ReplicaSet.yml")]),a._v(" 如下：")]),a._v(" "),s("div",{staticClass:"language-yaml line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("apiVersion")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" apps/v1\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("kind")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" ReplicaSet\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("metadata")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" nginx\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("labels")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("app")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" nginx\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("spec")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("replicas")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("3")]),a._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("selector")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("matchLabels")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("app")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" nginx \n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("template")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("metadata")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("labels")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("app")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" nginx\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("spec")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("containers")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" nginx\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("image")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" nginx"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("latest\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br"),s("span",{staticClass:"line-number"},[a._v("7")]),s("br"),s("span",{staticClass:"line-number"},[a._v("8")]),s("br"),s("span",{staticClass:"line-number"},[a._v("9")]),s("br"),s("span",{staticClass:"line-number"},[a._v("10")]),s("br"),s("span",{staticClass:"line-number"},[a._v("11")]),s("br"),s("span",{staticClass:"line-number"},[a._v("12")]),s("br"),s("span",{staticClass:"line-number"},[a._v("13")]),s("br"),s("span",{staticClass:"line-number"},[a._v("14")]),s("br"),s("span",{staticClass:"line-number"},[a._v("15")]),s("br"),s("span",{staticClass:"line-number"},[a._v("16")]),s("br"),s("span",{staticClass:"line-number"},[a._v("17")]),s("br"),s("span",{staticClass:"line-number"},[a._v("18")]),s("br"),s("span",{staticClass:"line-number"},[a._v("19")]),s("br")])]),s("p",[a._v("同样使用相同的命令进行创建以及查看ReplicaSet，发现与ReplicationController并没有什么区别，但是支持"),s("strong",[a._v("更强大的标签选择器")]),a._v("可以通过matchExpressions进行多个资源的匹配。")]),a._v(" "),s("div",{staticClass:"language-yaml line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[a._v("  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("selector")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("matchLabels")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("app")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" nginx \n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("matchExpressions")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("key")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" ENV"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("operator")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" In"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("values")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("test"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("key")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" app"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("operator")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" NotIn"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("values")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("redis"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br")])]),s("p",[a._v("matchExpressions其中包含数组，而数组中又分为map，每一个map的key的作用跟之前所说的标签选择器中的作用相同，其中operator字段略有不同，共分为以下4种情况：")]),a._v(" "),s("ul",[s("li",[s("strong",[a._v("In")]),a._v("：label的值在某个列表中")]),a._v(" "),s("li",[s("strong",[a._v("NotIn")]),a._v("：label的值不在某个列表中")]),a._v(" "),s("li",[s("strong",[a._v("Exists")]),a._v("：某个label存在")]),a._v(" "),s("li",[s("strong",[a._v("DoesNotExist")]),a._v("：某个label不存在")])]),a._v(" "),s("p",[a._v("需要注意的是，在selector中，必须"),s("strong",[a._v("同时满足matchLabels和matchExpressions的条件")]),a._v("才能匹配到对应的资源。")]),a._v(" "),s("p",[a._v("参考文章及书籍：")]),a._v(" "),s("ul",[s("li",[s("p",[s("a",{attrs:{href:"http://product.dangdang.com/26439199.html",target:"_blank",rel:"noopener noreferrer"}},[a._v("Kubernetes in Action"),s("OutboundLink")],1)])]),a._v(" "),s("li",[s("p",[s("a",{attrs:{href:"http://product.dangdang.com/29222386.html",target:"_blank",rel:"noopener noreferrer"}},[a._v("深入剖析Kubernetes"),s("OutboundLink")],1)])]),a._v(" "),s("li",[s("p",[s("a",{attrs:{href:"http://product.dangdang.com/29404674.html",target:"_blank",rel:"noopener noreferrer"}},[a._v("云原生Kubernetes全栈架构师实战"),s("OutboundLink")],1)])])])])}),[],!1,null,null,null);s.default=n.exports}}]);