(window.webpackJsonp=window.webpackJsonp||[]).push([[103],{476:function(t,s,a){"use strict";a.r(s);var e=a(1),v=Object(e.a)({},(function(){var t=this,s=t._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h1",{attrs:{id:"ansible的ad-hoc"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#ansible的ad-hoc"}},[t._v("#")]),t._v(" ansible的Ad-Hoc")]),t._v(" "),s("p",[t._v("Ad-Hoc，简而言之是“临时命令”，英文中作为形容词有“特别的，临时”的含义。")]),t._v(" "),s("h2",{attrs:{id:"_1-ad-hoc命令集用法"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-ad-hoc命令集用法"}},[t._v("#")]),t._v(" 1. Ad-Hoc命令集用法")]),t._v(" "),s("p",[t._v("命令使用方式如下：")]),t._v(" "),s("div",{staticClass:"language-bash line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("ansible "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("host-pattern"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("options"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br")])]),s("p",[t._v("可用选项如下：")]),t._v(" "),s("table",[s("thead",[s("tr",[s("th",[t._v("选项")]),t._v(" "),s("th",[t._v("描述")])])]),t._v(" "),s("tbody",[s("tr",[s("td",[t._v("-v，--verbose")]),t._v(" "),s("td",[t._v("输出更详细的执行过程信息，-vvv可得到执行过程所有信息。")])]),t._v(" "),s("tr",[s("td",[t._v("-i PATH，--inventory=PATH")]),t._v(" "),s("td",[t._v("指定inventory信息，默认/etc/ansible/hosts。")])]),t._v(" "),s("tr",[s("td",[t._v("-f NUM，--forks=NUM")]),t._v(" "),s("td",[t._v("并发线程数，默认5个线程。")])]),t._v(" "),s("tr",[s("td",[t._v("--private-key=PRIVATE_KEY_FILE")]),t._v(" "),s("td",[t._v("指定密钥文件。")])]),t._v(" "),s("tr",[s("td",[t._v("-m NAME，--module-name=NAME")]),t._v(" "),s("td",[t._v("指定执行使用的模块。")])]),t._v(" "),s("tr",[s("td",[t._v("-M MODULE_PATH, --module-path MODULE_PATH")]),t._v(" "),s("td",[t._v("指定模块存放路径，默认/usr/share/ansible，也可以通过ANSIBLE_LIBRARY设定默认路径。")])]),t._v(" "),s("tr",[s("td",[t._v("-a'ARGUMENTS'，--args='ARGUMENTS'")]),t._v(" "),s("td",[t._v("模块参数。")])]),t._v(" "),s("tr",[s("td",[t._v("-k，--ask-pass SSH")]),t._v(" "),s("td",[t._v("认证密码。")])]),t._v(" "),s("tr",[s("td",[t._v("-K，--ask-sudo-pass sudo")]),t._v(" "),s("td",[t._v("用户的密码（--sudo时使用）。")])]),t._v(" "),s("tr",[s("td",[t._v("-o，--one-line")]),t._v(" "),s("td",[t._v("标准输出至一行。")])]),t._v(" "),s("tr",[s("td",[t._v("-b, --become")]),t._v(" "),s("td",[t._v("相当于Linux系统下的sudo命令。")])]),t._v(" "),s("tr",[s("td",[t._v("-t DIRECTORY，--tree=DIRECTORY")]),t._v(" "),s("td",[t._v("输出信息至DIRECTORY目录下，结果文件以远程主机名命名。")])]),t._v(" "),s("tr",[s("td",[t._v("-T SECONDS，--timeout=SECONDS")]),t._v(" "),s("td",[t._v("指定连接远程主机的最大超时，单位是秒。")])]),t._v(" "),s("tr",[s("td",[t._v("-B NUM，--background=NUM")]),t._v(" "),s("td",[t._v("后台执行命令，超NUM秒后中止正在执行的任务。")])]),t._v(" "),s("tr",[s("td",[t._v("-P NUM，--poll=NUM")]),t._v(" "),s("td",[t._v("定期返回后台任务进度。")])]),t._v(" "),s("tr",[s("td",[t._v("-u USERNAME，--user=USERNAME")]),t._v(" "),s("td",[t._v("指定远程主机以USERNAME运行命令。")])]),t._v(" "),s("tr",[s("td",[t._v("-U SUDO_USERNAME，--sudo-user=SUDO_USERNAME")]),t._v(" "),s("td",[t._v("使用sudo，相当于Linux下的sudo命令。")])]),t._v(" "),s("tr",[s("td",[t._v("-c CONNECTION，--connection=CONNECTION")]),t._v(" "),s("td",[t._v("指定连接方式，可用选项paramiko（SSH）、ssh、local，local方式常用于crontab和kickstarts。")])]),t._v(" "),s("tr",[s("td",[t._v("-l SUBSET，--limit=SUBSET")]),t._v(" "),s("td",[t._v("指定运行主机。")])]),t._v(" "),s("tr",[s("td",[t._v("-l~REGEX，--limit=~REGEX")]),t._v(" "),s("td",[t._v("指定运行主机（正则）。")])]),t._v(" "),s("tr",[s("td",[t._v("--list-hosts")]),t._v(" "),s("td",[t._v("列出符合条件的主机列表，不执行任何命令。")])])])]),t._v(" "),s("p",[t._v("具体示例如下：")]),t._v(" "),s("div",{staticClass:"language-bash line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 批量查看apps组所有主机的磁盘容量（使用command模块）")]),t._v("\nansible apps "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-a")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"df -lh"')]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 安装nginx")]),t._v("\nansible apps "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-m")]),t._v(" yum "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-a")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"state=present name=nginx"')]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 启动nginx服务，并设置为开机启动")]),t._v("\nansible apps "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-m")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("service")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-a")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"name=nginx state=started enabled=yes"')]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br"),s("span",{staticClass:"line-number"},[t._v("6")]),s("br")])]),s("h3",{attrs:{id:"_1-1-ad-hoc特定主机变更"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-1-ad-hoc特定主机变更"}},[t._v("#")]),t._v(" 1.1. Ad-Hoc特定主机变更")]),t._v(" "),s("p",[t._v("Ansible有多种方式实现针对特定主机做变更。")]),t._v(" "),s("ul",[s("li",[s("strong",[t._v("--limit")]),t._v("：通过--limit参数限定主机做变更。")]),t._v(" "),s("li",[s("strong",[t._v("指定IP")]),t._v("：通过指定具体IP限定主机做变更。")]),t._v(" "),s("li",[t._v("用“：”作分隔符，指定多台机器做变更。")]),t._v(" "),s("li",[t._v("通过“*”泛匹配，更灵活地针对多台主机做变更。")])]),t._v(" "),s("p",[t._v("具体示例如下：")]),t._v(" "),s("div",{staticClass:"language-bash line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 在App组中启动192.168.37.15的nginx服务")]),t._v("\nansible app "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-m")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("command")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-a")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"systemctl start nginx"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--limit")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"192.168.37.158"')]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 查看192.168.37.158的nginx服务状态")]),t._v("\nansible "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("192.168")]),t._v(".37.158 "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-m")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("command")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-a")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"systemctl status nginx"')]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 查看192.168.37.158，192.168.37.161的nginx服务状态")]),t._v("\nansible "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"192.168.37.158:192.168.37.161"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-m")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("command")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-a")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"systemctl status nginx"')]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 启动192.168.37.*所有主机的nginx服务")]),t._v("\nansible "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("192.168")]),t._v(".37.* "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-m")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("command")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-a")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"systemctl start nginx"')]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br"),s("span",{staticClass:"line-number"},[t._v("6")]),s("br"),s("span",{staticClass:"line-number"},[t._v("7")]),s("br"),s("span",{staticClass:"line-number"},[t._v("8")]),s("br")])]),s("h2",{attrs:{id:"_2-ad-hoc用户管理与组管理"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-ad-hoc用户管理与组管理"}},[t._v("#")]),t._v(" 2. Ad-Hoc用户管理与组管理")]),t._v(" "),s("p",[t._v("用户权限管理是运维日常最重要的管理工作之一，所以掌握Ad-Hoc用户与组管理很有用。")]),t._v(" "),s("p",[t._v("Ansible系统用户模块有如下两个：")]),t._v(" "),s("ul",[s("li",[s("strong",[t._v("Linux系统用户管理")]),t._v("：user")]),t._v(" "),s("li",[s("strong",[t._v("Windows系统用户管理")]),t._v("：win_user")])]),t._v(" "),s("h3",{attrs:{id:"_2-1-linux用户管理"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-linux用户管理"}},[t._v("#")]),t._v(" 2.1. Linux用户管理")]),t._v(" "),s("table",[s("thead",[s("tr",[s("th",[t._v("参数")]),t._v(" "),s("th",[t._v("必填项")]),t._v(" "),s("th",[t._v("默认值")]),t._v(" "),s("th",[t._v("选项")]),t._v(" "),s("th",[t._v("注释")])])]),t._v(" "),s("tbody",[s("tr",[s("td",[t._v("append")]),t._v(" "),s("td",[t._v("no")]),t._v(" "),s("td",[t._v("no")]),t._v(" "),s("td",[t._v("yes"),s("br"),t._v("no")]),t._v(" "),s("td",[t._v("yes：用户添加到group中"),s("br"),t._v("no：只设置groups指定的group组，并移除其他用户组")])]),t._v(" "),s("tr",[s("td",[t._v("comment")]),t._v(" "),s("td",[t._v("no")]),t._v(" "),s("td"),t._v(" "),s("td"),t._v(" "),s("td",[t._v("可选设置用户账户的描述(又名GECOS)")])]),t._v(" "),s("tr",[s("td",[t._v("createhome")]),t._v(" "),s("td",[t._v("no")]),t._v(" "),s("td",[t._v("yes")]),t._v(" "),s("td",[t._v("yes"),s("br"),t._v("no")]),t._v(" "),s("td",[t._v("默认yes，当创建用户时或家目录不存在时为用户创建HOME目录")])]),t._v(" "),s("tr",[s("td",[t._v("expires")]),t._v(" "),s("td",[t._v("no")]),t._v(" "),s("td",[t._v("无")]),t._v(" "),s("td"),t._v(" "),s("td",[t._v("用户过期时间，不支持的平台该参数将被忽略，现在支持 Linux 和 FreeBSD")])]),t._v(" "),s("tr",[s("td",[t._v("force")]),t._v(" "),s("td",[t._v("no")]),t._v(" "),s("td",[t._v("no")]),t._v(" "),s("td",[t._v("yes"),s("br"),t._v("no")]),t._v(" "),s("td",[t._v("强制，当和state=absent结合使用时，效果等同于userdel --force")])]),t._v(" "),s("tr",[s("td",[t._v("generate_ssh key")]),t._v(" "),s("td",[t._v("no")]),t._v(" "),s("td",[t._v("no")]),t._v(" "),s("td",[t._v("yes"),s("br"),t._v("no")]),t._v(" "),s("td",[t._v("是否生成SSHkey，不会覆盖已有的SSHkey")])]),t._v(" "),s("tr",[s("td",[t._v("group")]),t._v(" "),s("td",[t._v("no")]),t._v(" "),s("td"),t._v(" "),s("td"),t._v(" "),s("td",[t._v("（可选）设置用户属组")])]),t._v(" "),s("tr",[s("td",[t._v("groups")]),t._v(" "),s("td",[t._v("no")]),t._v(" "),s("td"),t._v(" "),s("td"),t._v(" "),s("td",[t._v("设置用户附加群组，使用逗号分隔多个群组，如果参数为空(即’groups=‘），则删除用户所有附加组（属组不受影响）")])]),t._v(" "),s("tr",[s("td",[t._v("home")]),t._v(" "),s("td",[t._v("no")]),t._v(" "),s("td"),t._v(" "),s("td"),t._v(" "),s("td",[t._v("（可选）设置用户家日录")])]),t._v(" "),s("tr",[s("td",[t._v("login_class")]),t._v(" "),s("td",[t._v("no")]),t._v(" "),s("td"),t._v(" "),s("td"),t._v(" "),s("td",[t._v("（可选）设置FreeBSD、OpenBSD、NetBSD系统的用户登录class")])]),t._v(" "),s("tr",[s("td",[t._v("move_home")]),t._v(" "),s("td",[t._v("no")]),t._v(" "),s("td",[t._v("no")]),t._v(" "),s("td",[t._v("yes"),s("br"),t._v("no")]),t._v(" "),s("td",[t._v("如设置为yes，结合使用home=，临时迁移用户家目录到特定目录")])]),t._v(" "),s("tr",[s("td",[t._v("non_unique")]),t._v(" "),s("td",[t._v("no")]),t._v(" "),s("td",[t._v("no")]),t._v(" "),s("td",[t._v("yes"),s("br"),t._v("no")]),t._v(" "),s("td",[t._v("（可选）和结合使用，允许改变用户ID为非唯一值")])]),t._v(" "),s("tr",[s("td",[t._v("name")]),t._v(" "),s("td",[t._v("yes")]),t._v(" "),s("td"),t._v(" "),s("td"),t._v(" "),s("td",[t._v("用户名")])]),t._v(" "),s("tr",[s("td",[t._v("password")]),t._v(" "),s("td",[t._v("no")]),t._v(" "),s("td"),t._v(" "),s("td"),t._v(" "),s("td",[t._v("（可选）设置用户密码为该项指定的密码（加密后的密码）详细请参考https://docs.ansible.com/ansible/latest/reference_appendices/faq.html#how-do-i-generate-encrypted-passwords-for-the-user-module")])]),t._v(" "),s("tr",[s("td",[t._v("remove")]),t._v(" "),s("td",[t._v("no")]),t._v(" "),s("td",[t._v("no")]),t._v(" "),s("td",[t._v("yes"),s("br"),t._v("no")]),t._v(" "),s("td",[t._v("结合state=absent使用相当于userdel --remove")])]),t._v(" "),s("tr",[s("td",[t._v("seuser")]),t._v(" "),s("td",[t._v("no")]),t._v(" "),s("td"),t._v(" "),s("td"),t._v(" "),s("td",[t._v("（可选）设置seuser类型启用SELinux")])]),t._v(" "),s("tr",[s("td",[t._v("shell")]),t._v(" "),s("td",[t._v("no")]),t._v(" "),s("td"),t._v(" "),s("td"),t._v(" "),s("td",[t._v("（可选）设置用户shell")])]),t._v(" "),s("tr",[s("td",[t._v("skeleton")]),t._v(" "),s("td",[t._v("no")]),t._v(" "),s("td"),t._v(" "),s("td"),t._v(" "),s("td",[t._v("设置用户的skeleton目录，需和create_home参数结合使用")])]),t._v(" "),s("tr",[s("td",[t._v("ssh_key_bits")]),t._v(" "),s("td",[t._v("no")]),t._v(" "),s("td",[t._v("2048")]),t._v(" "),s("td"),t._v(" "),s("td",[t._v("（可选）指定生成的 SSH key 加密位数")])]),t._v(" "),s("tr",[s("td",[t._v("ssh_key_comment")]),t._v(" "),s("td",[t._v("no")]),t._v(" "),s("td"),t._v(" "),s("td"),t._v(" "),s("td",[t._v("（可选）定义 SSH key 注释")])]),t._v(" "),s("tr",[s("td",[t._v("ssh_key_file")]),t._v(" "),s("td",[t._v("no")]),t._v(" "),s("td",[t._v(".ssh/id_rsa")]),t._v(" "),s("td"),t._v(" "),s("td",[t._v("（可选）指定 SSH key 文件名，如果该文件名是相对路径，则默认路径为用户家目录")])]),t._v(" "),s("tr",[s("td",[t._v("ssh_key_passphrase")]),t._v(" "),s("td",[t._v("no")]),t._v(" "),s("td"),t._v(" "),s("td"),t._v(" "),s("td",[t._v("设置 SSH key 密码，如果没有提供密码，则默认没有加密")])]),t._v(" "),s("tr",[s("td",[t._v("ssh_key_type")]),t._v(" "),s("td",[t._v("no")]),t._v(" "),s("td",[t._v("rsa")]),t._v(" "),s("td"),t._v(" "),s("td",[t._v("（可选）指定 SSH key 类型，具体可用的 SSH key 类型取决于目标主机")])]),t._v(" "),s("tr",[s("td",[t._v("state")]),t._v(" "),s("td",[t._v("no")]),t._v(" "),s("td",[t._v("present")]),t._v(" "),s("td",[t._v("absent"),s("br"),t._v("present")]),t._v(" "),s("td",[t._v("absent：删除用户"),s("br"),t._v("present：新建用户")])]),t._v(" "),s("tr",[s("td",[t._v("system")]),t._v(" "),s("td",[t._v("no")]),t._v(" "),s("td",[t._v("no")]),t._v(" "),s("td",[t._v("yes"),s("br"),t._v("no")]),t._v(" "),s("td",[t._v("当创建新账户时，该选项为yes，为用户设置系统账户，该设置对已经存在的用户无效")])]),t._v(" "),s("tr",[s("td",[t._v("uid")]),t._v(" "),s("td",[t._v("no")]),t._v(" "),s("td"),t._v(" "),s("td"),t._v(" "),s("td",[t._v("（可选）设置用户 UID")])]),t._v(" "),s("tr",[s("td",[t._v("update_password")]),t._v(" "),s("td",[t._v("no")]),t._v(" "),s("td",[t._v("always")]),t._v(" "),s("td",[t._v("always"),s("br"),t._v("on_create")]),t._v(" "),s("td",[t._v("always：总是更改密码"),s("br"),t._v("on_create：只为新用户设置密码")])])])]),t._v(" "),s("h4",{attrs:{id:"_2-1-1-新增用户"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-1-新增用户"}},[t._v("#")]),t._v(" 2.1.1. 新增用户")]),t._v(" "),s("p",[t._v("新增用户dba，使用 BASH Shell，附加组为admins，dbagroup，家目录为"),s("code",[t._v("/home/dba")]),t._v("。")]),t._v(" "),s("div",{staticClass:"language-bash line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("ansible db "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-m")]),t._v(" user "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-a")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"name=dba shell=/bin/bash groups=admins,dbagroup append=yes home=/home/dba/ state=present"')]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br")])]),s("h4",{attrs:{id:"_2-1-2-修改用户属组"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-2-修改用户属组"}},[t._v("#")]),t._v(" 2.1.2. 修改用户属组")]),t._v(" "),s("p",[t._v("修改dba附加组为dbagroup（只保留dbagroup，其他所组删除）")]),t._v(" "),s("div",{staticClass:"language-bash line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("ansible db "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-m")]),t._v(" user "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-a")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"name=dba groups=dbagroup append=no"')]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br")])]),s("h4",{attrs:{id:"_2-1-3-修改用户属性"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-3-修改用户属性"}},[t._v("#")]),t._v(" 2.1.3. 修改用户属性")]),t._v(" "),s("p",[t._v("设置用户登录过期时间为：2023/12/31 00:00:00")]),t._v(" "),s("p",[t._v("时间采用UNIX时间戳进行设置，具体转换："),s("code",[t._v("date -d '2023/12/31 00:00:00' +%s")])]),t._v(" "),s("div",{staticClass:"language-bash line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("ansible db "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-m")]),t._v(" user "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-a")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"name=dba  expires=1703952000"')]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br")])]),s("h4",{attrs:{id:"_2-1-4-删除用户"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-4-删除用户"}},[t._v("#")]),t._v(" 2.1.4. 删除用户")]),t._v(" "),s("p",[t._v("删除用户DBA，并删除其家目录和邮件列表。")]),t._v(" "),s("div",{staticClass:"language-bash line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("ansible db "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-m")]),t._v(" user "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-a")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"name=dba state=absent remove=yes"')]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br")])]),s("h4",{attrs:{id:"_2-1-5-变更用户密码"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-5-变更用户密码"}},[t._v("#")]),t._v(" 2.1.5. 变更用户密码")]),t._v(" "),s("p",[t._v("设置系统用户dba的密码为dba123")]),t._v(" "),s("p",[t._v("参考："),s("a",{attrs:{href:"https://docs.ansible.com/ansible/latest/reference_appendices/faq.html#how-do-i-generate-encrypted-passwords-for-the-user-module",target:"_blank",rel:"noopener noreferrer"}},[t._v("How do I generate encrypted passwords for the user module?"),s("OutboundLink")],1)]),t._v(" "),s("div",{staticClass:"language-bash line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 生成加密密码")]),t._v("\nansible all "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-i")]),t._v(" localhost, "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-m")]),t._v(" debug "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-a")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("\"msg={{ 'dba123' | password_hash('sha512', 'mysecretsalt') }}\"")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 修改用户密码，$需要转义成\\$，然后就可以正常设置和登录了。")]),t._v("\nansible db "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-m")]),t._v(" user "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-a")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"name=dba shell=/bin/bash password=\\'),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$6")]),t._v("\\"),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$mysecretsalt")]),t._v("\\"),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$ISUzrEeBTw8zYoGLJaIbATE6hHVkJH1XvIcFEZaqeV")]),t._v('/aSITna5eWn3/HKiVLPc1HjXj6aE5WTe/uxLGbD5cbG/ update_password=always"')]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br")])]),s("h3",{attrs:{id:"_2-2-windows用户管理"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-windows用户管理"}},[t._v("#")]),t._v(" 2.2. Windows用户管理")]),t._v(" "),s("p",[t._v("暂时跳过。")]),t._v(" "),s("h3",{attrs:{id:"_2-3-应用层用户管理"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-3-应用层用户管理"}},[t._v("#")]),t._v(" 2.3. 应用层用户管理")]),t._v(" "),s("p",[t._v("以MySQL用户管理为例。")]),t._v(" "),s("p",[t._v("新增MySQL用户stanley，设置登录密码为magedu@bj，对zabbix.*表有ALL权限。")]),t._v(" "),s("div",{staticClass:"language-bash line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# pip需要安装 pymysql")]),t._v("\npip3 "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v(" pymysql\nansible db "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-m")]),t._v(" mysql_user "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-a")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'login_user=root login_password=123456 name=stanley password=magedu@bj priv=zabbix.*:ALL state=present'")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br")])])])}),[],!1,null,null,null);s.default=v.exports}}]);